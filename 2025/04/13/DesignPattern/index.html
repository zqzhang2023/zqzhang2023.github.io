<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>C++ 设计模式 | 张振强的个人博客</title><meta name="author" content="张振强"><meta name="copyright" content="张振强"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="C++设计模式资料https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_52860170&#x2F;article&#x2F;details&#x2F;142577985 软件的设计原则目的：为了提高软件系统的可维护性、可复用性，增强软件的可扩展性、灵活性 开闭原则（OCP）软件实体对扩展是开放的，但对修改是关闭的，即在不修改一个软件实体的基础上去扩展其功能。 对扩展开放，对修改关闭 实现：接口和抽象类 里氏替换原则（LSP）任何">
<meta property="og:type" content="article">
<meta property="og:title" content="C++ 设计模式">
<meta property="og:url" content="http://example.com/2025/04/13/DesignPattern/index.html">
<meta property="og:site_name" content="张振强的个人博客">
<meta property="og:description" content="C++设计模式资料https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_52860170&#x2F;article&#x2F;details&#x2F;142577985 软件的设计原则目的：为了提高软件系统的可维护性、可复用性，增强软件的可扩展性、灵活性 开闭原则（OCP）软件实体对扩展是开放的，但对修改是关闭的，即在不修改一个软件实体的基础上去扩展其功能。 对扩展开放，对修改关闭 实现：接口和抽象类 里氏替换原则（LSP）任何">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/img/cover/3.png">
<meta property="article:published_time" content="2025-04-12T16:09:37.000Z">
<meta property="article:modified_time" content="2025-04-13T12:17:37.300Z">
<meta property="article:author" content="张振强">
<meta property="article:tag" content="学习">
<meta property="article:tag" content="设计模式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/img/cover/3.png"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "C++ 设计模式",
  "url": "http://example.com/2025/04/13/DesignPattern/",
  "image": "http://example.com/img/cover/3.png",
  "datePublished": "2025-04-12T16:09:37.000Z",
  "dateModified": "2025-04-13T12:17:37.300Z",
  "author": [
    {
      "@type": "Person",
      "name": "张振强",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favicon_1.png"><link rel="canonical" href="http://example.com/2025/04/13/DesignPattern/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"未找到符合您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'C++ 设计模式',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/img/index_img.jpg);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/load4.gif" data-original="/img/paidaxing_icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/cover/3.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">张振强的个人博客</span></a><a class="nav-page-title" href="/"><span class="site-name">C++ 设计模式</span></a></span><div id="menus"><div id="search-button"><span class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></span></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fa fa-graduation-cap"></i><span> 博文</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><span class="site-page group"><i class="fa-fw fas fa-list"></i><span> 生活</span><i class="fas fa-chevron-down"></i></span><ul class="menus_item_child"><li><a class="site-page child" href="/shuoshuo/"><i class="fa-fw fa fa-comment"></i><span> 分享</span></a></li><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 相册</span></a></li><li><a class="site-page child" href="/music/"><i class="fa-fw fa fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 影视</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于笔者</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">C++ 设计模式</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-04-12T16:09:37.000Z" title="发表于 2025-04-13 00:09:37">2025-04-13</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-04-13T12:17:37.300Z" title="更新于 2025-04-13 20:17:37">2025-04-13</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/C-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">C++ 设计模式</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">总字数:</span><span class="word-count">13.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>59分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="C-设计模式"><a href="#C-设计模式" class="headerlink" title="C++设计模式"></a>C++设计模式</h1><p><strong>资料</strong><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_52860170/article/details/142577985">https://blog.csdn.net/qq_52860170/article/details/142577985</a></p>
<h2 id="软件的设计原则"><a href="#软件的设计原则" class="headerlink" title="软件的设计原则"></a>软件的设计原则</h2><p>目的：为了提高软件系统的可维护性、可复用性，增强软件的可扩展性、灵活性</p>
<h3 id="开闭原则（OCP）"><a href="#开闭原则（OCP）" class="headerlink" title="开闭原则（OCP）"></a>开闭原则（OCP）</h3><p>软件实体对扩展是开放的，但对修改是关闭的，即在不修改一个软件实体的基础上去扩展其功能。</p>
<p>对扩展开放，对修改关闭</p>
<p>实现：接口和抽象类</p>
<h3 id="里氏替换原则（LSP）"><a href="#里氏替换原则（LSP）" class="headerlink" title="里氏替换原则（LSP）"></a>里氏替换原则（LSP）</h3><p>任何基类可以出现的地方，子类一定可以出现，通俗来说，子类可以扩展父类的功能，但不能改变父类原有的功能</p>
<h3 id="依赖倒置原则-DIP"><a href="#依赖倒置原则-DIP" class="headerlink" title="依赖倒置原则(DIP)"></a>依赖倒置原则(DIP)</h3><p>高层模块不应该依赖于低层模块，两者都应该依赖于抽象；抽象不应该依赖于细节，细节应该依赖于抽象；对抽象编程，不对实现编程，降低了客户与实现模块间的耦合。</p>
<h3 id="接口隔离原则-ISP"><a href="#接口隔离原则-ISP" class="headerlink" title="接口隔离原则(ISP)"></a>接口隔离原则(ISP)</h3><p>客户端不应该被迫依赖于它不使用的方法；一个类对另一个类的依赖应该建立在最小的接口上。</p>
<h3 id="单一职责原则-SRP"><a href="#单一职责原则-SRP" class="headerlink" title="单一职责原则(SRP)"></a>单一职责原则(SRP)</h3><p>一个类应该有且仅有一个职责</p>
<p>比如：手机：拍照、摄影、游戏、GPS</p>
<p>拆分成多个类:</p>
<p>拍摄职责：照相机、摄影机</p>
<p>游戏：PSP</p>
<p>GPS：专业GPS导航</p>
<h2 id="高内聚、低耦合"><a href="#高内聚、低耦合" class="headerlink" title="高内聚、低耦合"></a>高内聚、低耦合</h2><h2 id="创建型模式"><a href="#创建型模式" class="headerlink" title="创建型模式"></a>创建型模式</h2><h3 id="简单工厂模式"><a href="#简单工厂模式" class="headerlink" title="简单工厂模式"></a>简单工厂模式</h3><p>只需要知道水果的名字则可得到相应的水果</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/1_%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/2_%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F_%E8%A7%92%E8%89%B2.png" alt="alt text"></p>
<p>角色：</p>
<ul>
<li><p>Factory：工厂角色</p>
</li>
<li><p>Product：抽象产品角色</p>
</li>
<li><p>ConcreteProduct：具体产品角色</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的产品：圆形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;绘制圆形&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的产品：矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;绘制矩形&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 工厂类，静态的创建函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Shape* <span class="title">createShape</span><span class="params">(<span class="type">const</span> string&amp; type)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (type == <span class="string">&quot;Circle&quot;</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Circle</span>();</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(type == <span class="string">&quot;Rectangle&quot;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Rectangle</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="built_in">invalid_argument</span>(<span class="string">&quot;无效的形状类型！&quot;</span>);        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        Shape* circle = ShapeFactory::<span class="built_in">createShape</span>(<span class="string">&quot;Circle&quot;</span>);</span><br><span class="line">        Shape* rectangle = ShapeFactory::<span class="built_in">createShape</span>(<span class="string">&quot;Rectangle&quot;</span>);</span><br><span class="line"></span><br><span class="line">        circle-&gt;<span class="built_in">draw</span>();      <span class="comment">// 输出：绘制圆形</span></span><br><span class="line">        rectangle-&gt;<span class="built_in">draw</span>();   <span class="comment">// 输出：绘制矩形</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">delete</span> circle;</span><br><span class="line">        <span class="keyword">delete</span> rectangle;</span><br><span class="line"></span><br><span class="line">        Shape* unknown = ShapeFactory::<span class="built_in">createShape</span>(<span class="string">&quot;Triangle&quot;</span>);</span><br><span class="line"></span><br><span class="line">    &#125;<span class="built_in">catch</span>(<span class="type">const</span> exception&amp; e)&#123;</span><br><span class="line">        cout &lt;&lt; e.<span class="built_in">what</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单工厂模式虽然很好用，但是其违背了 <strong>开闭原则</strong> 当需要添加一个产品的时候，需要修改createShape部分的代码，因此便引入了工厂模式。</p>
<p>PPT之中一个例子<br><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/3_%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<h3 id="工厂模式"><a href="#工厂模式" class="headerlink" title="工厂模式"></a>工厂模式</h3><p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/4_%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<p>通过 将对象的实例化推迟到子类 来实现：每个具体工厂类只需要关注自己负责的产品创建，系统的扩展通过新增工厂-产品对实现，而不是修改现有代码。这种设计更符合面向对象的设计原则，特别适合需要支持多平台、多系列产品等场景。</p>
<ul>
<li><p>抽象工厂：提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法来创建产品</p>
</li>
<li><p>具体工厂：主要是实现抽象工厂中的抽象方法，完成具体产品的创建</p>
</li>
<li><p>抽象产品：定义了产品的规范，描述了产品的主要特性和功能</p>
</li>
<li><p>具体产品：实现了抽象产品角色所定义的接口，由具体工厂来创建，它同具体工厂之间一一对应</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的产品：圆形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>: <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;绘制圆形&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体的产品：矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span> : <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;绘制矩形&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加产品： 三角形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Triangle</span> : <span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;绘制三角形&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象工厂类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Shape* <span class="title">createShape</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ShapeFactory</span>()&#123;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 圆形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CircleFactory</span>: <span class="keyword">public</span> ShapeFactory&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shape* <span class="title">createShape</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Circle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 矩形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RectangleFactory</span>: <span class="keyword">public</span> ShapeFactory&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shape* <span class="title">createShape</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Rectangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增 三角形工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TriangleFactory</span>: <span class="keyword">public</span> ShapeFactory&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">Shape* <span class="title">createShape</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Triangle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ShapeFactory* circleFactory = <span class="keyword">new</span> <span class="built_in">CircleFactory</span>();</span><br><span class="line">    Shape* circle = circleFactory-&gt;<span class="built_in">createShape</span>();</span><br><span class="line">    </span><br><span class="line">    ShapeFactory* rectangleFactory = <span class="keyword">new</span> <span class="built_in">RectangleFactory</span>();</span><br><span class="line">    Shape* rectangle = rectangleFactory-&gt;<span class="built_in">createShape</span>();</span><br><span class="line"></span><br><span class="line">    circle-&gt;<span class="built_in">draw</span>();      <span class="comment">// 输出：绘制圆形</span></span><br><span class="line">    rectangle-&gt;<span class="built_in">draw</span>();   <span class="comment">// 输出：绘制矩形</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//新增：</span></span><br><span class="line">    ShapeFactory* triangleFactory = <span class="keyword">new</span> <span class="built_in">TriangleFactory</span>();</span><br><span class="line">    Shape* triangle = triangleFactory-&gt;<span class="built_in">createShape</span>();</span><br><span class="line">    triangle-&gt;<span class="built_in">draw</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> circle;</span><br><span class="line">    <span class="keyword">delete</span> rectangle;</span><br><span class="line">    <span class="keyword">delete</span> circleFactory;</span><br><span class="line">    <span class="keyword">delete</span> rectangleFactory;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> triangle;</span><br><span class="line">    <span class="keyword">delete</span> triangleFactory;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="抽象工程模式"><a href="#抽象工程模式" class="headerlink" title="抽象工程模式"></a>抽象工程模式</h3><p>提供一个创建一系列相关或相互依赖对象的接口，而无需指定他们具体的类</p>
<p>当系统所提供的工厂所需生产的具体产品并不是一个简单的对象，而是多个位于不同产品等级结构中属于不同类型的具体产品时需要使用抽象工厂模式</p>
<p>抽象工厂模式与工厂方法模式最大的区别在于，工厂方法模式针对的是一个产品等级结构，而抽象工厂模式则需要面对多个产品等级结构。</p>
<ul>
<li><p>抽象工厂：提供了创建产品的接口，包含多个创建产品的方法，可以创建多个不同等级的产品</p>
</li>
<li><p>具体工厂：实现了抽象工厂中的多个抽象方法，完成具体产品的创建</p>
</li>
<li><p>抽象产品：定义了产品的规范，描述了产品的主要特征和功能，抽象工厂模式有多个抽象产品</p>
</li>
<li><p>具体产品：实现了抽象产品所定义的接口，由具体工厂来创建，它具体工厂是多对一关系</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/5_%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- 抽象产品接口 -------------------------</span></span><br><span class="line"><span class="comment">// 按钮抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Button</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">render</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Button</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 文本框抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextBox</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">input</span><span class="params">(<span class="type">const</span> string&amp; text)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">TextBox</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开关抽象类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Switch</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">toggle</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Switch</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- 具体产品实现 -------------------------</span></span><br><span class="line"><span class="comment">// 现代风格组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernButton</span>: <span class="keyword">public</span> Button&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">render</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;渲染现代风格按钮 [▣ Minimal]&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernTextBox</span> : <span class="keyword">public</span> TextBox &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">input</span><span class="params">(<span class="type">const</span> string&amp; text)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;现代风格文本框输入: \&quot;&quot;</span> &lt;&lt; text &lt;&lt; <span class="string">&quot;\&quot; (无边框)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernSwitch</span> : <span class="keyword">public</span> Switch &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">toggle</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;切换现代风格开关 ●━━━━●&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复古风格组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetroButton</span> : <span class="keyword">public</span> Button &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">render</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;渲染复古风格按钮 [▣ Beveled]&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetroTextBox</span> : <span class="keyword">public</span> TextBox &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">input</span><span class="params">(<span class="type">const</span> string&amp; text)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;复古风格文本框输入: \&quot;&quot;</span> &lt;&lt; text &lt;&lt; <span class="string">&quot;\&quot; (像素字体)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetroSwitch</span> : <span class="keyword">public</span> Switch &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">toggle</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;切换复古开关 ◈━━━◈&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- 抽象工厂接口 -------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UIFactory</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> unique_ptr&lt;Button&gt; <span class="title">createButton</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> unique_ptr&lt;TextBox&gt; <span class="title">createTextBox</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> unique_ptr&lt;Switch&gt; <span class="title">createSwitch</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">UIFactory</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- 具体工厂实现 -------------------------</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ModernUIFactory</span> : <span class="keyword">public</span> UIFactory &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">unique_ptr&lt;Button&gt; <span class="title">createButton</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;ModernButton&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">unique_ptr&lt;TextBox&gt; <span class="title">createTextBox</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;ModernTextBox&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">unique_ptr&lt;Switch&gt; <span class="title">createSwitch</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;ModernSwitch&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RetroUIFactory</span> : <span class="keyword">public</span> UIFactory &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">unique_ptr&lt;Button&gt; <span class="title">createButton</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;RetroButton&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">unique_ptr&lt;TextBox&gt; <span class="title">createTextBox</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;RetroTextBox&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">unique_ptr&lt;Switch&gt; <span class="title">createSwitch</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">make_unique</span>&lt;RetroSwitch&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ------------------------- 客户端代码 -------------------------</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">createUI</span><span class="params">(<span class="type">const</span> unique_ptr&lt;UIFactory&gt;&amp; factory)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> button = factory-&gt;<span class="built_in">createButton</span>();</span><br><span class="line">    <span class="keyword">auto</span> textbox = factory-&gt;<span class="built_in">createTextBox</span>();</span><br><span class="line">    <span class="keyword">auto</span> switchCtrl = factory-&gt;<span class="built_in">createSwitch</span>();</span><br><span class="line"></span><br><span class="line">    button-&gt;<span class="built_in">render</span>();</span><br><span class="line">    textbox-&gt;<span class="built_in">input</span>(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">    switchCtrl-&gt;<span class="built_in">toggle</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;=== 现代风格 UI ===&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">createUI</span>(<span class="built_in">make_unique</span>&lt;ModernUIFactory&gt;());</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n=== 复古风格 UI ===&quot;</span> &lt;&lt; endl;</span><br><span class="line">    <span class="built_in">createUI</span>(<span class="built_in">make_unique</span>&lt;RetroUIFactory&gt;());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三种工厂模式对比表</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>简单工厂模式</th>
<th>工厂方法模式</th>
<th>抽象工厂模式</th>
</tr>
</thead>
<tbody><tr>
<td>创建目标</td>
<td>单一产品</td>
<td>单一产品</td>
<td>产品家族（多个关联产品）</td>
</tr>
<tr>
<td>扩展维度</td>
<td>垂直扩展（产品类型）</td>
<td>垂直扩展（产品类型）</td>
<td>水平扩展（产品家族）</td>
</tr>
<tr>
<td>开闭原则</td>
<td>违反</td>
<td>支持产品扩展</td>
<td>支持产品族扩展</td>
</tr>
<tr>
<td>工厂类数量</td>
<td>1个全能工厂</td>
<td>N个工厂对应N个产品</td>
<td>N个工厂对应N个产品族</td>
</tr>
<tr>
<td>适用场景</td>
<td>简单对象创建</td>
<td>单一产品扩展</td>
<td>多系列关联对象创建</td>
</tr>
</tbody></table>
<h3 id="单例模式"><a href="#单例模式" class="headerlink" title="单例模式"></a>单例模式</h3><p>单例模式确保一个类只有一个实例，并提供一个全局访问点。</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/6_%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">Singleton</span>() = <span class="keyword">default</span>; <span class="comment">// 私有构造函数</span></span><br><span class="line">    ~<span class="built_in">Singleton</span>() = <span class="keyword">default</span>; <span class="comment">// 私有析构函数（可选）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 删除拷贝和赋值操作</span></span><br><span class="line">    <span class="built_in">Singleton</span>(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;</span><br><span class="line">    Singleton&amp; <span class="keyword">operator</span>=(<span class="type">const</span> Singleton&amp;) = <span class="keyword">delete</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">static</span> Singleton&amp; <span class="title">getInstance</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="type">static</span> Singleton instance; <span class="comment">// 线程安全且自动析构</span></span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">testFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;testFunction&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Singleton::<span class="built_in">getInstance</span>().<span class="built_in">testFunction</span>();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="生成器-buider-模式"><a href="#生成器-buider-模式" class="headerlink" title="生成器(buider)模式"></a>生成器(buider)模式</h3><p>将一个复杂对象的构建与分离分开表示，使得同样的构建过程可以创建不同的表示</p>
<ul>
<li><p>分离了部件的构造(由Builder来负责)和装配(由Director负责)。 从而可以构造出复杂的对象。这个模式适用于: 某个对象的构建过程复杂的情况。</p>
</li>
<li><p>由于实现了构建和装配的解耦。不同的构建器，相同的装配，也可以做出不同的对象，相同的构建器，不同的装配顺序也可以做出不同的对象。也就是实现了构建算法、装配算法的解耦，实现了更好的复用。</p>
</li>
<li><p>建造者模式可以将部件和其组装过程分开，一步一步创建一个复杂的对象。用户只需要指定复杂对象的类型就可以得到该对象，而无须知道其内部的具体构造细节。</p>
</li>
</ul>
<p><strong>结构</strong></p>
<ul>
<li><p>抽象建造者类：这个接口规定要实现复杂对象的哪些部分的创建，并不涉及具体对象部件的创建。</p>
</li>
<li><p>具体建造者类：实现Builder接口，完成复杂产品的各个部件的具体创建方法。在构造过程完成后，提供产品的实例。</p>
</li>
<li><p>产品类：要创建的复杂对象</p>
</li>
<li><p>指挥者类：调用具体的建造者来创建复杂对象的各个部分，在指导者中不涉及具体产品的信息，只负责保证对象各部分完整创建或按某种顺序创建</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/7_%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 产品类：Computer</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Computer</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string m_cpu;</span><br><span class="line">    string m_memory;</span><br><span class="line">    string m_hardDisk;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCPU</span><span class="params">(<span class="type">const</span> string&amp; cpu)</span></span>&#123; m_cpu = cpu;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMemory</span><span class="params">(<span class="type">const</span> string&amp; memory)</span> </span>&#123; m_memory = memory; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setHardDisk</span><span class="params">(<span class="type">const</span> string&amp; hardDisk)</span> </span>&#123; m_hardDisk = hardDisk; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">show</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Computer Configuration:&quot;</span> &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;CPU: &quot;</span> &lt;&lt; m_cpu &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Memory: &quot;</span> &lt;&lt; m_memory &lt;&lt; endl;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Hard Disk: &quot;</span> &lt;&lt; m_hardDisk &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象建造者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ComputerBuilder</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">buildCPU</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">buildMemory</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">buildHardDisk</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Computer* <span class="title">getResult</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ComputerBuilder</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//  具体建造者：高端配置</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HighEndComputerBuilder</span> : <span class="keyword">public</span> ComputerBuilder &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Computer* m_computer;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">HighEndComputerBuilder</span>() : <span class="built_in">m_computer</span>(<span class="keyword">new</span> <span class="built_in">Computer</span>()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildCPU</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setCPU</span>(<span class="string">&quot;Intel Core i9-12900K&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildMemory</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setMemory</span>(<span class="string">&quot;64GB DDR5 4800MHz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildHardDisk</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setHardDisk</span>(<span class="string">&quot;2TB Samsung 980 Pro NVMe SSD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Computer* <span class="title">getResult</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_computer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">HighEndComputerBuilder</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> m_computer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体建造者：办公配置</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OfficeComputerBuilder</span> : <span class="keyword">public</span> ComputerBuilder &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Computer* m_computer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">OfficeComputerBuilder</span>() : <span class="built_in">m_computer</span>(<span class="keyword">new</span> <span class="built_in">Computer</span>()) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildCPU</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setCPU</span>(<span class="string">&quot;Intel Core i5-12400&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildMemory</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setMemory</span>(<span class="string">&quot;16GB DDR4 3200MHz&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">buildHardDisk</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        m_computer-&gt;<span class="built_in">setHardDisk</span>(<span class="string">&quot;512GB Crucial P2 NVMe SSD&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Computer* <span class="title">getResult</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> m_computer;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">OfficeComputerBuilder</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> m_computer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 指挥者类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">construct</span><span class="params">(ComputerBuilder* builder)</span></span>&#123;</span><br><span class="line">        builder-&gt;<span class="built_in">buildCPU</span>();</span><br><span class="line">        builder-&gt;<span class="built_in">buildMemory</span>();</span><br><span class="line">        builder-&gt;<span class="built_in">buildHardDisk</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Director director;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建高端电脑</span></span><br><span class="line">    HighEndComputerBuilder highEndBuilder;</span><br><span class="line">    director.<span class="built_in">construct</span>(&amp;highEndBuilder);</span><br><span class="line">    Computer* gamingPC = highEndBuilder.<span class="built_in">getResult</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;High-end Gaming PC:&quot;</span> &lt;&lt; endl;</span><br><span class="line">    gamingPC-&gt;<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建办公电脑</span></span><br><span class="line">    OfficeComputerBuilder officeBuilder;</span><br><span class="line">    director.<span class="built_in">construct</span>(&amp;officeBuilder);</span><br><span class="line">    Computer* officePC = officeBuilder.<span class="built_in">getResult</span>();</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Office PC:&quot;</span> &lt;&lt; endl;</span><br><span class="line">    officePC-&gt;<span class="built_in">show</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="结构型模式"><a href="#结构型模式" class="headerlink" title="结构型模式"></a>结构型模式</h2><p>描述如何将类和对象按某种布局组成更大的结构</p>
<h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>为其他对象提供一种代理以控制对该对象的访问</p>
<ul>
<li><p>远程（Remote）代理：为一个对象在不同地址空间提供局部代表</p>
</li>
<li><p>虚拟（Virtual）代理：在需要创建开销很大对象时缓存对象信息</p>
</li>
<li><p>保护（Protection）代理：控制对原始对象的访问</p>
</li>
<li><p>智能引用（Smart Reference）代理：当一个对象被引用时，提供一些额外的操作，例如记录访问的流量和次数等</p>
</li>
</ul>
<p>结构：</p>
<ul>
<li><p>抽象主题类：通过接口或抽象类声明真实主题和代理对象实现的业务方法</p>
</li>
<li><p>真实主题类：实现了抽象主题中的具体业务，是代理对象所代表的真实对象，是最终要引用的对象</p>
</li>
<li><p>代理类：提供了与真实主题相同的接口，其内部含有对真实主题的引用，它可以访问、控制、扩展真实主图的功能</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/8_%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<p>样例：</p>
<p>如果对象是一个大图片,需要花费很长时间才能显示出来，此时需要做个图片Proxy来代替真正的图片</p>
<p>如果对象在某远端服务器上,直接操作这个对象因为网络速度原因可能比较慢，那我们可以先用Proxy来代替那个对象</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Image</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">display</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Image</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 真实主题类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RealImage</span>: <span class="keyword">public</span> Image&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string filename;</span><br><span class="line">    <span class="comment">// 从磁盘之中加载图片</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">loadFromDisk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Loading image: &quot;</span> &lt;&lt; filename &lt;&lt; <span class="string">&quot; from disk&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">RealImage</span>(<span class="type">const</span> string&amp; filename):<span class="built_in">filename</span>(filename)&#123;</span><br><span class="line">        <span class="built_in">loadFromDisk</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Displaying image: &quot;</span> &lt;&lt; filename &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 代理类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ProxyImage</span> :<span class="keyword">public</span> Image&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    RealImage* realImage = <span class="literal">nullptr</span>;</span><br><span class="line">    string filename;</span><br><span class="line">    <span class="type">bool</span> accessAllowed = <span class="literal">true</span>; <span class="comment">// 简单的访问控制标志</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">checkAccess</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 这里可以添加更复杂的访问控制逻辑</span></span><br><span class="line">        <span class="keyword">return</span> accessAllowed;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">logAccess</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Logged access to image: &quot;</span> &lt;&lt; filename &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ProxyImage</span>(<span class="type">const</span> string&amp; filename) : <span class="built_in">filename</span>(filename) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="built_in">checkAccess</span>()) &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;Access denied for image: &quot;</span> &lt;&lt; filename &lt;&lt; std::endl;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (realImage == <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            realImage = <span class="keyword">new</span> <span class="built_in">RealImage</span>(filename); <span class="comment">// 延迟初始化</span></span><br><span class="line">        &#125;</span><br><span class="line">        realImage-&gt;<span class="built_in">display</span>();</span><br><span class="line">        <span class="built_in">logAccess</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ~<span class="built_in">ProxyImage</span>() &#123;</span><br><span class="line">        <span class="keyword">delete</span> realImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Image* image1 = <span class="keyword">new</span> <span class="built_in">ProxyImage</span>(<span class="string">&quot;photo1.jpg&quot;</span>);</span><br><span class="line">    Image* image2 = <span class="keyword">new</span> <span class="built_in">ProxyImage</span>(<span class="string">&quot;photo2.jpg&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第一次访问会加载图片</span></span><br><span class="line">    image1-&gt;<span class="built_in">display</span>(); </span><br><span class="line"></span><br><span class="line">    <span class="comment">// 第二次访问直接显示（已加载）</span></span><br><span class="line">    image1-&gt;<span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    image2-&gt;<span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> image1;</span><br><span class="line">    <span class="keyword">delete</span> image2;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="适配器模式"><a href="#适配器模式" class="headerlink" title="适配器模式"></a>适配器模式</h3><p>将一个类的接口换成客户希望的另一个接口，使得原本由于接口不兼容而不能在一起工作那些类能一起工作</p>
<p>分类：</p>
<ul>
<li><p>类适配器模式（耦合更高，应用较少）</p>
</li>
<li><p>对象适配器模式</p>
</li>
</ul>
<p>结构：</p>
<ul>
<li><p>目标接口：当前系统业务所期待的接口，它可以是抽象类或者接口</p>
</li>
<li><p>适配者类：它是被访问和适配的现存主件库中的组件接口</p>
</li>
<li><p>适配器类：它是一个转换器，通过继承或引用适配者的对象，把适配者接口转换成目标接口，让客户按照目标接口的格式访问适配者</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 目标接口（Target Interface） - 客户端期望的充电器规格</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Charger</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">charge</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Charger</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 被适配者（Adaptee） - 已存在的欧洲插头实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EuroPlug</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">specificCharge</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;⚡ 使用欧洲插头充电 (220V)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 适配器（Adapter） - 将欧洲插头适配到标准充电器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EuroChargerAdapter</span> : <span class="keyword">public</span> Charger&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    EuroPlug* euroPlug_;  <span class="comment">// 持有被适配对象的指针</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">EuroChargerAdapter</span>(EuroPlug* plug)&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;euroPlug_ = plug;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">charge</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(euroPlug_) &#123;</span><br><span class="line">            <span class="comment">//使用转接口之后，就可以用欧洲的插头了</span></span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;🔌 使用电源适配器转换&quot;</span> &lt;&lt; endl;</span><br><span class="line">            euroPlug_-&gt;<span class="built_in">specificCharge</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建被适配的欧洲插头</span></span><br><span class="line">    EuroPlug euroPlug;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 创建适配器并将欧洲插头接入</span></span><br><span class="line">    Charger* charger = <span class="keyword">new</span> <span class="built_in">EuroChargerAdapter</span>(&amp;euroPlug);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用标准接口充电</span></span><br><span class="line">    charger-&gt;<span class="built_in">charge</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> charger;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="装饰者模式"><a href="#装饰者模式" class="headerlink" title="装饰者模式"></a>装饰者模式</h3><p>指在不改变现有对象结构的情况下，动态的给该对象增加一些职责（增加额外功能）的模式</p>
<p>例子：快餐店有炒面、炒饭这些快餐，可以额外附加鸡蛋、火腿、培根这些配菜，当然加配菜需要额外加钱，每个配菜的价钱通常不太一样，那么计算总价就会显得比较麻烦。</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/9_%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">double</span> <span class="title">cost</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">description</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Beverage</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体组件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Espresso</span>: <span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">cost</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1.99</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">description</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Espresso&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象装饰者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CondimentDecorator</span> : <span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Beverage* beverage;  <span class="comment">// 被装饰的对象</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CondimentDecorator</span>(Beverage* b) : <span class="built_in">beverage</span>(b) &#123;&#125;;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">CondimentDecorator</span>()&#123;</span><br><span class="line">        <span class="keyword">delete</span> beverage;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者：摩卡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mocha</span> : <span class="keyword">public</span> CondimentDecorator &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Mocha</span>(Beverage* b) : <span class="built_in">CondimentDecorator</span>(b) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">cost</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beverage-&gt;<span class="built_in">cost</span>() + <span class="number">0.20</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">description</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beverage-&gt;<span class="built_in">description</span>() + <span class="string">&quot;, Mocha&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者：牛奶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Milk</span> : <span class="keyword">public</span> CondimentDecorator &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Milk</span>(Beverage* b) : <span class="built_in">CondimentDecorator</span>(b) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">cost</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beverage-&gt;<span class="built_in">cost</span>() + <span class="number">0.50</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">description</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beverage-&gt;<span class="built_in">description</span>() + <span class="string">&quot;, Milk&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 创建基础饮料</span></span><br><span class="line">    Beverage* espresso = <span class="keyword">new</span> <span class="built_in">Espresso</span>();</span><br><span class="line">    cout &lt;&lt; espresso-&gt;<span class="built_in">description</span>() </span><br><span class="line">              &lt;&lt; <span class="string">&quot; $&quot;</span> &lt;&lt; espresso-&gt;<span class="built_in">cost</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 用装饰者添加配料</span></span><br><span class="line">    Beverage* espressoWithMocha = <span class="keyword">new</span> <span class="built_in">Mocha</span>(espresso);</span><br><span class="line">    Beverage* espressoWithMochaMilk = <span class="keyword">new</span> <span class="built_in">Milk</span>(espressoWithMocha);</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; espressoWithMochaMilk-&gt;<span class="built_in">description</span>() </span><br><span class="line">              &lt;&lt; <span class="string">&quot; $&quot;</span> &lt;&lt; espressoWithMochaMilk-&gt;<span class="built_in">cost</span>() &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意：装饰者会负责删除被装饰对象</span></span><br><span class="line">    <span class="keyword">delete</span> espressoWithMochaMilk;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="桥接模式"><a href="#桥接模式" class="headerlink" title="桥接模式"></a>桥接模式</h3><p>​ 将抽象和实现分离，使它们可以独立变化。它是组合关系代替继承关系来实现的，从而降低了抽象和实现这两个可变维度的耦合度。</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/10_%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<p>结构：</p>
<ul>
<li><p>抽象化角色：定义抽象类，并包含一个对实现化角色的引用</p>
</li>
<li><p>扩展抽象化角色：是抽象化角色的子类，实现父类中的业务方法，并通过组合关系调用实现化角色中的业务方法</p>
</li>
<li><p>实现化角色：定义实现化角色的接口，供扩展抽象化角色调用</p>
</li>
<li><p>具体实现化角色：给出实现化角色接口的具体实现</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/11_%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DrawAPI</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">const</span> string&amp; shape)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">DrawAPI</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现：使用OpenGL绘图</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OpenGLAPI</span>:<span class="keyword">public</span> DrawAPI&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">const</span> string&amp; shape)</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;OpenGL绘制: &quot;</span>&lt;&lt;shape&lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现：使用DirectX绘图</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DirectXAPI</span>: <span class="keyword">public</span> DrawAPI&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">const</span> string&amp; shape)</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;DirectX绘制: &quot;</span>&lt;&lt;shape&lt;&lt; endl;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象部分：图形基类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Shape</span>&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    unique_ptr&lt;DrawAPI&gt; drawAPI;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Shape</span>(DrawAPI * api):<span class="built_in">drawAPI</span>(api)&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">draw</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Shape</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//圆形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Circle</span>:<span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string myShape;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Circle</span>(string shape,DrawAPI * api):<span class="built_in">Shape</span>(api),<span class="built_in">myShape</span>(shape)&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        drawAPI-&gt;<span class="built_in">draw</span>(<span class="keyword">this</span>-&gt;myShape);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//矩形</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Rectangle</span>:<span class="keyword">public</span> Shape&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string myShape;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Rectangle</span>(string shape,DrawAPI * api):<span class="built_in">Shape</span>(api),<span class="built_in">myShape</span>(shape)&#123;&#125;;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        drawAPI-&gt;<span class="built_in">draw</span>(<span class="keyword">this</span>-&gt;myShape);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用OpenGL绘制圆形</span></span><br><span class="line">    unique_ptr&lt;Shape&gt; circle = <span class="built_in">make_unique</span>&lt;Circle&gt;(<span class="string">&quot;圆形&quot;</span>, <span class="keyword">new</span> <span class="built_in">OpenGLAPI</span>());</span><br><span class="line">    <span class="comment">// 使用DirectX绘制矩形</span></span><br><span class="line">    unique_ptr&lt;Shape&gt; rect = <span class="built_in">make_unique</span>&lt;Rectangle&gt;(<span class="string">&quot;矩形&quot;</span>, <span class="keyword">new</span> <span class="built_in">DirectXAPI</span>());</span><br><span class="line">    </span><br><span class="line">    circle-&gt;<span class="built_in">draw</span>();</span><br><span class="line">    rect-&gt;<span class="built_in">draw</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试其他组合</span></span><br><span class="line">    Shape* openglRect = <span class="keyword">new</span> <span class="built_in">Rectangle</span>(<span class="string">&quot;矩形&quot;</span>, <span class="keyword">new</span> <span class="built_in">OpenGLAPI</span>());</span><br><span class="line">    Shape* directxCircle = <span class="keyword">new</span> <span class="built_in">Circle</span>(<span class="string">&quot;圆形&quot;</span>, <span class="keyword">new</span> <span class="built_in">DirectXAPI</span>());</span><br><span class="line">    </span><br><span class="line">    openglRect-&gt;<span class="built_in">draw</span>();</span><br><span class="line">    directxCircle-&gt;<span class="built_in">draw</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">delete</span> openglRect;</span><br><span class="line">    <span class="keyword">delete</span> directxCircle;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="外观模式"><a href="#外观模式" class="headerlink" title="外观模式"></a>外观模式</h3><p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/12_%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<p>结构：</p>
<ul>
<li><p>外观角色：为多个子系统对外提供一个共同的接口</p>
</li>
<li><p>子系统角色：实现系统的部分功能，客户可以通过外观角色访问它</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子系统类：音频解码器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioDecoder</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">decodeAudio</span><span class="params">(<span class="type">const</span> string&amp; file)</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;解码音频: &quot;</span> &lt;&lt; file &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子系统类：视频解码器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VideoDecoder</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">decodeVideo</span><span class="params">(<span class="type">const</span> string&amp; file)</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;解码视频: &quot;</span> &lt;&lt; file &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//子系统类：文件加载器</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileLoader</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function">string <span class="title">load</span><span class="params">(<span class="type">const</span> string&amp; path)</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;加载文件: &quot;</span> &lt;&lt; path &lt;&lt; endl;</span><br><span class="line">        <span class="keyword">return</span> path.<span class="built_in">substr</span>(path.<span class="built_in">find_last_of</span>(<span class="string">&quot;/&quot;</span>) + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//外观类：封装多媒体播放的复杂操作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PlaybackManager</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    FileLoader    fileLoader;</span><br><span class="line">    AudioDecoder  audioDecoder;</span><br><span class="line">    VideoDecoder  videoDecoder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">play</span><span class="params">(<span class="type">const</span> string&amp; filePath)</span> </span>&#123;</span><br><span class="line">        string fileName = fileLoader.<span class="built_in">load</span>(filePath);</span><br><span class="line">        audioDecoder.<span class="built_in">decodeAudio</span>(fileName);</span><br><span class="line">        videoDecoder.<span class="built_in">decodeVideo</span>(fileName);</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;开始播放 &quot;</span> &lt;&lt; fileName &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 客户端代码</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    PlaybackManager player;</span><br><span class="line">    player.<span class="built_in">play</span>(<span class="string">&quot;/media/movie.mp4&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="组合模式"><a href="#组合模式" class="headerlink" title="组合模式"></a>组合模式</h3><p>部分整体模式，是用于把一组相似的对象当做一个单一的对象，组合模式依据树形结构来组合对象，用来表示部分以及整体层次。这种类型的设计模式属于结构型模式，她创建了对象组的树形结构。</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/13_%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<p>结构：</p>
<ul>
<li><p>抽象根节点：定义系统各层次对象共有方法和属性，可以预先定义一些默认行为和属性</p>
</li>
<li><p>树枝节点：定义树枝节点的行为，存储子节点，组合树枝节点和叶子节点形成一个树形结构</p>
</li>
<li><p>叶子节点：叶子节点对象，其下再无分支，是系统层次遍历的最小单位</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileSystemComponent</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">display</span><span class="params">(<span class="type">int</span> depth = <span class="number">0</span>)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">size_t</span> <span class="title">getSize</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">FileSystemComponent</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 叶子节点：文件</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">File</span> : <span class="keyword">public</span> FileSystemComponent &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string name_;</span><br><span class="line">    <span class="type">size_t</span> size_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">File</span>(<span class="type">const</span> string&amp; name,<span class="type">size_t</span> size):<span class="built_in">name_</span>(name),<span class="built_in">size_</span>(size)&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(<span class="type">int</span> depth = <span class="number">0</span>)</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">string</span>(depth, <span class="string">&#x27;\t&#x27;</span>) &lt;&lt; <span class="string">&quot;📄 &quot;</span> &lt;&lt; name_ </span><br><span class="line">            &lt;&lt; <span class="string">&quot; (&quot;</span> &lt;&lt; size_ &lt;&lt; <span class="string">&quot; bytes)&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">getSize</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123; <span class="keyword">return</span> size_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 复合节点：目录</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Directory</span>:<span class="keyword">public</span> FileSystemComponent&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string name_;</span><br><span class="line">    vector&lt;shared_ptr&lt;FileSystemComponent&gt;&gt; children_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Directory</span>(<span class="type">const</span> string&amp; name) : <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addComponent</span><span class="params">(shared_ptr&lt;FileSystemComponent&gt; component)</span></span>&#123;</span><br><span class="line">        children_.<span class="built_in">push_back</span>(component);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">removeComponent</span><span class="params">(shared_ptr&lt;FileSystemComponent&gt; component)</span></span>&#123;</span><br><span class="line">        children_.<span class="built_in">erase</span>(</span><br><span class="line">            <span class="built_in">remove</span>(children_.<span class="built_in">begin</span>(), children_.<span class="built_in">end</span>(), component),</span><br><span class="line">            children_.<span class="built_in">end</span>()</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">(<span class="type">int</span> depth = <span class="number">0</span>)</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="built_in">string</span>(depth, <span class="string">&#x27;\t&#x27;</span>) &lt;&lt; <span class="string">&quot;📁 &quot;</span> &lt;&lt; name_ </span><br><span class="line">            &lt;&lt; <span class="string">&quot; [&quot;</span> &lt;&lt; <span class="built_in">getSize</span>() &lt;&lt; <span class="string">&quot; bytes]&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; child : children_) &#123;</span><br><span class="line">            child-&gt;<span class="built_in">display</span>(depth + <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">getSize</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="type">size_t</span> total = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; child : children_) &#123;</span><br><span class="line">            total += child-&gt;<span class="built_in">getSize</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> total;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// 创建文件</span></span><br><span class="line">    <span class="keyword">auto</span> file1 = <span class="built_in">make_shared</span>&lt;File&gt;(<span class="string">&quot;document.txt&quot;</span>, <span class="number">1500</span>);</span><br><span class="line">    <span class="keyword">auto</span> file2 = <span class="built_in">make_shared</span>&lt;File&gt;(<span class="string">&quot;image.jpg&quot;</span>, <span class="number">2500</span>);</span><br><span class="line">    <span class="keyword">auto</span> file3 = <span class="built_in">make_shared</span>&lt;File&gt;(<span class="string">&quot;notes.md&quot;</span>, <span class="number">800</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建子目录</span></span><br><span class="line">    <span class="keyword">auto</span> subdir = <span class="built_in">make_shared</span>&lt;Directory&gt;(<span class="string">&quot;Downloads&quot;</span>);</span><br><span class="line">    subdir-&gt;<span class="built_in">addComponent</span>(file2);</span><br><span class="line">    subdir-&gt;<span class="built_in">addComponent</span>(file3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建根目录</span></span><br><span class="line">    <span class="keyword">auto</span> root = <span class="built_in">make_shared</span>&lt;Directory&gt;(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line">    root-&gt;<span class="built_in">addComponent</span>(file1);</span><br><span class="line">    root-&gt;<span class="built_in">addComponent</span>(subdir);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 添加另一个文件到根目录</span></span><br><span class="line">    root-&gt;<span class="built_in">addComponent</span>(<span class="built_in">make_shared</span>&lt;File&gt;(<span class="string">&quot;backup.zip&quot;</span>, <span class="number">4200</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 显示整个结构</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;File System Structure:\n&quot;</span>;</span><br><span class="line">    root-&gt;<span class="built_in">display</span>();</span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\nTotal size of root: &quot;</span> </span><br><span class="line">            &lt;&lt; root-&gt;<span class="built_in">getSize</span>() &lt;&lt; <span class="string">&quot; bytes&quot;</span> &lt;&lt; endl;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="享元模式"><a href="#享元模式" class="headerlink" title="享元模式"></a>享元模式</h3><p>​运用共享技术来有效地支持大量细粒度对象的复用。它通过共享已经存在的对象来大幅度减少需要创建的对象数量、避免大量相似对象的开销，从而提高系统资源的利用率。</p>
<p>内部状态。不会随着环境的改变而改变的可共享部分</p>
<p>外部状态。随着环境的改变而改变的不可共享的部分。享元模式的实现要领就是区分应用中的这两种状态，并将外部状态外部化。</p>
<p>引例：</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/14_%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元对象：包含树木的固有属性（内部状态）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeType</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string name_;   <span class="comment">// 内部状态</span></span><br><span class="line">    string color_;  <span class="comment">// 内部状态</span></span><br><span class="line">    string texture_; <span class="comment">// 内部状态</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TreeType</span>(<span class="type">const</span> string&amp; name, <span class="type">const</span> string&amp; color, <span class="type">const</span> string&amp; texture)</span><br><span class="line">        : <span class="built_in">name_</span>(name), <span class="built_in">color_</span>(color), <span class="built_in">texture_</span>(texture) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> age)</span> <span class="type">const</span> </span>&#123; <span class="comment">// 外部状态作为参数</span></span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;绘制 &quot;</span> &lt;&lt; name_ &lt;&lt; <span class="string">&quot; 在 (&quot;</span> &lt;&lt; x &lt;&lt; <span class="string">&quot;, &quot;</span> &lt;&lt; y </span><br><span class="line">                  &lt;&lt; <span class="string">&quot;)，颜色：&quot;</span> &lt;&lt; color_ </span><br><span class="line">                  &lt;&lt; <span class="string">&quot;，纹理：&quot;</span> &lt;&lt; texture_</span><br><span class="line">                  &lt;&lt; <span class="string">&quot;，年龄：&quot;</span> &lt;&lt; age &lt;&lt; <span class="string">&quot;年\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 享元工厂</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TreeFactory</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unordered_map&lt;string,TreeType&gt; treeTypes_;</span><br><span class="line">    <span class="comment">// 生成唯一键</span></span><br><span class="line">    <span class="function">string <span class="title">makeKey</span><span class="params">(<span class="type">const</span> string&amp; name, </span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="type">const</span> string&amp; color, </span></span></span><br><span class="line"><span class="params"><span class="function">                <span class="type">const</span> string&amp; texture)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;_&quot;</span> + color + <span class="string">&quot;_&quot;</span> + texture;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">const</span> TreeType&amp; <span class="title">getTreeType</span><span class="params">(<span class="type">const</span> string&amp; name, </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">const</span> string&amp; color, </span></span></span><br><span class="line"><span class="params"><span class="function">                               <span class="type">const</span> string&amp; texture)</span> </span>&#123;</span><br><span class="line">        string key = <span class="built_in">makeKey</span>(name, color, texture);</span><br><span class="line">        <span class="comment">// 如果不存在则创建新类型</span></span><br><span class="line">        <span class="keyword">if</span> (treeTypes_.<span class="built_in">find</span>(key) == treeTypes_.<span class="built_in">end</span>()) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;创建新的树木类型: &quot;</span> &lt;&lt; key &lt;&lt; endl;</span><br><span class="line">            treeTypes_.<span class="built_in">emplace</span>(key, <span class="built_in">TreeType</span>(name, color, texture));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> treeTypes_.<span class="built_in">at</span>(key);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 包含外部状态的树木对象</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tree</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> x_;         <span class="comment">// 外部状态</span></span><br><span class="line">    <span class="type">int</span> y_;         <span class="comment">// 外部状态</span></span><br><span class="line">    <span class="type">int</span> age_;       <span class="comment">// 外部状态</span></span><br><span class="line">    <span class="type">const</span> TreeType&amp; type_; <span class="comment">// 指向享元的引用</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Tree</span>(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> age, <span class="type">const</span> TreeType&amp; type)</span><br><span class="line">        : <span class="built_in">x_</span>(x), <span class="built_in">y_</span>(y), <span class="built_in">age_</span>(age), <span class="built_in">type_</span>(type) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        type_.<span class="built_in">draw</span>(x_, y_, age_);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 森林包含多个树木</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Forest</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;Tree&gt; trees_;</span><br><span class="line">    TreeFactory factory_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">plantTree</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">int</span> age,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">const</span> string&amp; name,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">const</span> string&amp; color,</span></span></span><br><span class="line"><span class="params"><span class="function">                   <span class="type">const</span> string&amp; texture)</span> </span>&#123;</span><br><span class="line">        <span class="type">const</span> TreeType&amp; type = factory_.<span class="built_in">getTreeType</span>(name, color, texture);</span><br><span class="line">        trees_.<span class="built_in">emplace_back</span>(x, y, age, type);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">draw</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">const</span> <span class="keyword">auto</span>&amp; tree : trees_) &#123;</span><br><span class="line">            tree.<span class="built_in">draw</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Forest forest;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 种植不同类型的树</span></span><br><span class="line">    forest.<span class="built_in">plantTree</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="string">&quot;松树&quot;</span>, <span class="string">&quot;深绿&quot;</span>, <span class="string">&quot;针叶纹理&quot;</span>);</span><br><span class="line">    forest.<span class="built_in">plantTree</span>(<span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="string">&quot;橡树&quot;</span>, <span class="string">&quot;浅绿&quot;</span>, <span class="string">&quot;宽叶纹理&quot;</span>);</span><br><span class="line">    forest.<span class="built_in">plantTree</span>(<span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="string">&quot;松树&quot;</span>, <span class="string">&quot;深绿&quot;</span>, <span class="string">&quot;针叶纹理&quot;</span>); <span class="comment">// 复用已有类型</span></span><br><span class="line">    forest.<span class="built_in">plantTree</span>(<span class="number">7</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="string">&quot;白桦&quot;</span>, <span class="string">&quot;白色&quot;</span>, <span class="string">&quot;条纹纹理&quot;</span>);</span><br><span class="line">    forest.<span class="built_in">plantTree</span>(<span class="number">9</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="string">&quot;橡树&quot;</span>, <span class="string">&quot;浅绿&quot;</span>, <span class="string">&quot;宽叶纹理&quot;</span>); <span class="comment">// 复用已有类型</span></span><br><span class="line"></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;\n开始绘制森林：\n&quot;</span>;</span><br><span class="line">    forest.<span class="built_in">draw</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="行为型模式"><a href="#行为型模式" class="headerlink" title="行为型模式"></a>行为型模式</h2><p>行为型模式用于描述程序在运行时复杂的流程控制，即描述多个类或对象之间怎样相互协作共同完成单个对象都无法完成的任务，涉及算法与对象之间职责的分配</p>
<ul>
<li><p>类行为型模式（继承实现）</p>
</li>
<li><p>对象行为型模式（组合或聚合实现）（满足合成复用原则，灵活性高）</p>
</li>
</ul>
<h3 id="模板方法模式"><a href="#模板方法模式" class="headerlink" title="模板方法模式"></a>模板方法模式</h3><p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/15_%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<p>​ 定义一个操作中的算法骨架，而将算法的一些步骤延迟到子类中，使得子类可以不改变算法结构的情况下重定义该算法的某些特定步骤</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Beverage</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">prepareBeverage</span><span class="params">()</span> <span class="keyword">final</span> </span>&#123;</span><br><span class="line">        <span class="built_in">boilWater</span>();</span><br><span class="line">        <span class="built_in">brew</span>();</span><br><span class="line">        <span class="built_in">pourInCup</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">customerWantsCondiments</span>()) &#123; <span class="comment">// 钩子方法</span></span><br><span class="line">            <span class="built_in">addCondiments</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="comment">// 具体方法（已实现）</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">boilWater</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Boiling water&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pourInCup</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Pouring into cup&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象方法（需要子类实现）</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">brew</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">addCondiments</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 钩子方法（可选重写）</span></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">customerWantsCondiments</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// 默认添加调料</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体子类：咖啡</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Coffee</span>:<span class="keyword">public</span> Beverage&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">brew</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Brewing coffee grounds&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addCondiments</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Adding sugar and milk&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重写钩子方法</span></span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">customerWantsCondiments</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="type">char</span> choice;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Would you like milk and sugar with your coffee? (y/n) &quot;</span>;</span><br><span class="line">        std::cin &gt;&gt; choice;</span><br><span class="line">        <span class="keyword">return</span> choice == <span class="string">&#x27;y&#x27;</span> || choice == <span class="string">&#x27;Y&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体子类：茶</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Tea</span> : <span class="keyword">public</span> Beverage &#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">brew</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Steeping the tea&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addCondiments</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Adding lemon&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 不重写钩子方法，保持默认添加调料</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Making coffee:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    Coffee coffee;</span><br><span class="line">    coffee.<span class="built_in">prepareBeverage</span>();</span><br><span class="line"></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;\nMaking tea:&quot;</span> &lt;&lt; std::endl;</span><br><span class="line">    Tea tea;</span><br><span class="line">    tea.<span class="built_in">prepareBeverage</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="策略模式"><a href="#策略模式" class="headerlink" title="策略模式"></a>策略模式</h3><p>​该模式定义了一系列算法，并将每个算法封装起来，使它们可以相互替换，且算法的变化不会影响到使用算法的用户，策略模式属于对象行为模式，通过对算法进行封装，把使用算法的责任和算法是实现分割开来，并委派给不同对象对这些算法进行管理</p>
<p>结构:</p>
<ul>
<li><p>抽象策略类：通常由一个接口或抽象类来实现，此角色给出所有具体策略类所需的接口</p>
</li>
<li><p>具体策略类：实现了抽象策略类所定义的接口，提供具体的算法实现或行为</p>
</li>
<li><p>环境类：持有一个策略类的引用，最终给客户端调用</p>
</li>
</ul>
<p>策略模式引例</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/16_%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 策略接口：支付方式</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PaymentStrategy</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">double</span> amount)</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">PaymentStrategy</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CreditCardPayment</span>:<span class="keyword">public</span> PaymentStrategy&#123;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">double</span> amount)</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;使用信用卡支付：&quot;</span> &lt;&lt; amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt;endl;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：支付宝支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AlipayPayment</span>:<span class="keyword">public</span> PaymentStrategy&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">double</span> amount)</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;使用支付宝支付：&quot;</span> &lt;&lt; amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：微信支付</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeChatPayment</span>:<span class="keyword">public</span> PaymentStrategy&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pay</span><span class="params">(<span class="type">double</span> amount)</span> <span class="type">const</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;使用微信支付：&quot;</span> &lt;&lt; amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类：订单</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Order</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unique_ptr&lt;PaymentStrategy&gt; thisPaymentStrategy;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setPaymentStrategy</span><span class="params">(unique_ptr&lt;PaymentStrategy&gt; strategy)</span></span>&#123;</span><br><span class="line">        thisPaymentStrategy = <span class="built_in">move</span>(strategy);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">checkout</span><span class="params">(<span class="type">double</span> amount)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (thisPaymentStrategy) &#123;</span><br><span class="line">            thisPaymentStrategy-&gt;<span class="built_in">pay</span>(amount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            std::cout &lt;&lt; <span class="string">&quot;错误：未选择支付方式！\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Order order;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用信用卡支付</span></span><br><span class="line">    order.<span class="built_in">setPaymentStrategy</span>(<span class="built_in">make_unique</span>&lt;CreditCardPayment&gt;());</span><br><span class="line">    order.<span class="built_in">checkout</span>(<span class="number">100.50</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 切换为支付宝支付</span></span><br><span class="line">    order.<span class="built_in">setPaymentStrategy</span>(std::<span class="built_in">make_unique</span>&lt;AlipayPayment&gt;());</span><br><span class="line">    order.<span class="built_in">checkout</span>(<span class="number">200.0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 切换为微信支付</span></span><br><span class="line">    order.<span class="built_in">setPaymentStrategy</span>(std::<span class="built_in">make_unique</span>&lt;WeChatPayment&gt;());</span><br><span class="line">    order.<span class="built_in">checkout</span>(<span class="number">50.0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="命令模式"><a href="#命令模式" class="headerlink" title="命令模式"></a>命令模式</h3><p>将一个请求封装为一个对象，使发出请求的责任和执行请求的责任分隔开，这样两者之间通过命令对象进行沟通，这样方便将命令对象进行存储、传递、调用、增加和管理</p>
<p>结构：</p>
<ul>
<li><p>抽象命令类角色：定义命令的接口，声明执行的方法</p>
</li>
<li><p>具体命令角色：具体的命令，实现命令接口；通常会持有接受者，并调用接受者的功能来完成命令要执行的操作</p>
</li>
<li><p>实现者&#x2F;接受者角色：接受者，真正执行命令的对象，任何类都可成为一个接收者，只要它能够实现命令要求实现的相应的功能</p>
</li>
<li><p>调用者&#x2F;请求者角色：要求命令对象执行请求，通常会持有命令对象，可以持有很多命令对象</p>
</li>
</ul>
<p>引例：</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/17_%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<p>简单的：遥控器，集成很多的命令</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 接收者接口（家电基类）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Appliance</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">on</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">off</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Appliance</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体接收者：电灯</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Light</span>:<span class="keyword">public</span> Appliance&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;电灯打开了&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">off</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;电灯关闭了&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体接收者：风扇</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Fan</span>:<span class="keyword">public</span> Appliance&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">on</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;风扇打开了&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">off</span><span class="params">()</span> <span class="keyword">override</span></span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;风扇关闭了&quot;</span>&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 命令接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Command</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">execute</span><span class="params">()</span> </span>= <span class="number">0</span>; </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">undo</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Command</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令：打开命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TurnOnCommand</span>:<span class="keyword">public</span> Command&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Appliance* appliance;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TurnOnCommand</span>(Appliance* app) : <span class="built_in">appliance</span>(app) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; appliance-&gt;<span class="built_in">on</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; appliance-&gt;<span class="built_in">off</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令：关闭命令</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TurnOffCommand</span> : <span class="keyword">public</span> Command &#123;</span><br><span class="line">    Appliance* appliance;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TurnOffCommand</span>(Appliance* app) : <span class="built_in">appliance</span>(app) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">execute</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; appliance-&gt;<span class="built_in">off</span>(); &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">undo</span><span class="params">()</span> <span class="keyword">override</span> </span>&#123; appliance-&gt;<span class="built_in">on</span>(); &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用者（遥控器按钮）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">RemoteControl</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    Command * command;</span><br><span class="line">    Command* lastCommand;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setCommand</span><span class="params">(Command* cmd)</span> </span>&#123;</span><br><span class="line">        command = cmd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pressButton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        command-&gt;<span class="built_in">execute</span>();</span><br><span class="line">        lastCommand = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">pressUndo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(lastCommand) &#123;</span><br><span class="line">            lastCommand-&gt;<span class="built_in">undo</span>();</span><br><span class="line">            lastCommand = <span class="literal">nullptr</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="comment">// 创建家电设备</span></span><br><span class="line">    Light livingRoomLight;</span><br><span class="line">    Fan bathroomFan;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建命令</span></span><br><span class="line">    <span class="function">TurnOnCommand <span class="title">lightOn</span><span class="params">(&amp;livingRoomLight)</span></span>;</span><br><span class="line">    <span class="function">TurnOffCommand <span class="title">fanOff</span><span class="params">(&amp;bathroomFan)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置遥控器</span></span><br><span class="line">    RemoteControl remote;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 测试电灯控制</span></span><br><span class="line">    remote.<span class="built_in">setCommand</span>(&amp;lightOn);</span><br><span class="line">    remote.<span class="built_in">pressButton</span>();  <span class="comment">// 开灯</span></span><br><span class="line">    remote.<span class="built_in">pressUndo</span>();    <span class="comment">// 关灯</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 测试风扇控制</span></span><br><span class="line">    remote.<span class="built_in">setCommand</span>(&amp;fanOff);</span><br><span class="line">    remote.<span class="built_in">pressButton</span>();  <span class="comment">// 关风扇</span></span><br><span class="line">    remote.<span class="built_in">pressUndo</span>();    <span class="comment">// 开风扇</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="责任链模式"><a href="#责任链模式" class="headerlink" title="责任链模式"></a>责任链模式</h3><p>又名职责链模式，为了避免请求发送者与多个请求处理者耦合在一起，将所有请求的处理者通过前一对象记住其下一个对象的引用而连成一条链；当有请求发生时，可将请求沿着这条链传递，直到有对象处理它为止。</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/18_%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 请求类（采购请求）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">PurchaseRequest</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="type">int</span> type;  <span class="comment">// 请求类型</span></span><br><span class="line">    <span class="type">int</span> id;     <span class="comment">// 请求ID</span></span><br><span class="line">    <span class="type">double</span> amount; <span class="comment">// 金额</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">PurchaseRequest</span>(<span class="type">int</span> t, <span class="type">int</span> i, <span class="type">double</span> a)</span><br><span class="line">        : <span class="built_in">type</span>(t), <span class="built_in">id</span>(i), <span class="built_in">amount</span>(a) &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//抽象处理者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Approver</span>&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Approver * successor; <span class="comment">// 下一级处理者</span></span><br><span class="line">    string name;         <span class="comment">// 处理者名称</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Approver</span>(string n) : <span class="built_in">name</span>(n), <span class="built_in">successor</span>(<span class="literal">nullptr</span>) &#123;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setSuccessor</span><span class="params">(Approver* s)</span> </span>&#123;</span><br><span class="line">        successor = s;</span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">processRequest</span><span class="params">(PurchaseRequest* request)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者：经理（可审批5000元以下）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Manager</span> :<span class="keyword">public</span> Approver&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Manager</span>(string n) : <span class="built_in">Approver</span>(n) &#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processRequest</span><span class="params">(PurchaseRequest* request)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(request-&gt;amount&lt;<span class="number">5000</span>)&#123;</span><br><span class="line">            cout &lt;&lt; name &lt;&lt; <span class="string">&quot;经理审批采购单#&quot;</span></span><br><span class="line">                 &lt;&lt; request-&gt;id &lt;&lt; <span class="string">&quot;，金额：&quot;</span></span><br><span class="line">                 &lt;&lt; request-&gt;amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            successor-&gt;<span class="built_in">processRequest</span>(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者：总监（可审批10000元以下）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Director</span> : <span class="keyword">public</span> Approver &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Director</span>(string n) : <span class="built_in">Approver</span>(n) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processRequest</span><span class="params">(PurchaseRequest* request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (request-&gt;amount &lt; <span class="number">10000</span>) &#123;</span><br><span class="line">            cout &lt;&lt; name &lt;&lt; <span class="string">&quot;总监审批采购单#&quot;</span></span><br><span class="line">                 &lt;&lt; request-&gt;id &lt;&lt; <span class="string">&quot;，金额：&quot;</span></span><br><span class="line">                 &lt;&lt; request-&gt;amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt; endl;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (successor != <span class="literal">nullptr</span>) &#123;</span><br><span class="line">            successor-&gt;<span class="built_in">processRequest</span>(request);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者：CEO（可审批任意金额）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CEO</span> : <span class="keyword">public</span> Approver &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CEO</span>(string n) : <span class="built_in">Approver</span>(n) &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">processRequest</span><span class="params">(PurchaseRequest* request)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; name &lt;&lt; <span class="string">&quot;CEO审批采购单#&quot;</span></span><br><span class="line">             &lt;&lt; request-&gt;id &lt;&lt; <span class="string">&quot;，金额：&quot;</span></span><br><span class="line">             &lt;&lt; request-&gt;amount &lt;&lt; <span class="string">&quot;元&quot;</span> &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建处理者</span></span><br><span class="line">    <span class="function">Manager <span class="title">manager</span><span class="params">(<span class="string">&quot;张&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">Director <span class="title">director</span><span class="params">(<span class="string">&quot;王&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">CEO <span class="title">ceo</span><span class="params">(<span class="string">&quot;李&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置责任链</span></span><br><span class="line">    manager.<span class="built_in">setSuccessor</span>(&amp;director);</span><br><span class="line">    director.<span class="built_in">setSuccessor</span>(&amp;ceo);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建请求</span></span><br><span class="line">    <span class="function">PurchaseRequest <span class="title">req1</span><span class="params">(<span class="number">1</span>, <span class="number">1001</span>, <span class="number">4500</span>)</span></span>;</span><br><span class="line">    <span class="function">PurchaseRequest <span class="title">req2</span><span class="params">(<span class="number">2</span>, <span class="number">1002</span>, <span class="number">8000</span>)</span></span>;</span><br><span class="line">    <span class="function">PurchaseRequest <span class="title">req3</span><span class="params">(<span class="number">3</span>, <span class="number">1003</span>, <span class="number">150000</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 从链首开始处理请求</span></span><br><span class="line">    manager.<span class="built_in">processRequest</span>(&amp;req1); <span class="comment">// 经理处理</span></span><br><span class="line">    manager.<span class="built_in">processRequest</span>(&amp;req2); <span class="comment">// 总监处理</span></span><br><span class="line">    manager.<span class="built_in">processRequest</span>(&amp;req3); <span class="comment">// CEO处理</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h3 id="状态模式"><a href="#状态模式" class="headerlink" title="状态模式"></a>状态模式</h3><p>​对有状态的对象，把复杂的“判断逻辑”提取到不同的状态对象中，允许状态对象在其内部状态发生改变时改变其行为</p>
<p>结构：</p>
<ul>
<li><p>环境角色：也称上下文，它定义了客户程序需要的接口，维护一个当前状态，并将与状态相关的操作委托给当前状态对像来处理</p>
</li>
<li><p>抽象状态：定义了一个接口，用以封装环境对象中的特定状态所对应的行为</p>
</li>
<li><p>具体状态：实现抽象状态所对应的行为</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/19_%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElevatorContext</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象状态接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElevatorState</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">openDoors</span><span class="params">(ElevatorContext* context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">closeDoors</span><span class="params">(ElevatorContext* context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">move</span><span class="params">(ElevatorContext* context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">stop</span><span class="params">(ElevatorContext* context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">ElevatorState</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 提前声明具体状态类（关键修改点）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorsOpenState</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorsClosedState</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovingState</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ElevatorContext</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unique_ptr&lt;ElevatorState&gt; currentState;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">ElevatorContext</span>(unique_ptr&lt;ElevatorState&gt; state);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 委托方法给当前状态</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">requestOpenDoors</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">requestCloseDoors</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">requestMove</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">requestStop</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 状态转移</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">changeState</span><span class="params">(unique_ptr&lt;ElevatorState&gt; state)</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">displayState</span><span class="params">(<span class="type">const</span> string&amp; stateName)</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类实现</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorsOpenState</span> : <span class="keyword">public</span> ElevatorState &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">openDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">closeDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DoorsClosedState</span> : <span class="keyword">public</span> ElevatorState &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">openDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">closeDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MovingState</span> : <span class="keyword">public</span> ElevatorState &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">openDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">closeDoors</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">move</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">stop</span><span class="params">(ElevatorContext* context)</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 上下文类方法实现</span></span><br><span class="line">ElevatorContext::<span class="built_in">ElevatorContext</span>(unique_ptr&lt;ElevatorState&gt; state)</span><br><span class="line">    : <span class="built_in">currentState</span>(<span class="built_in">move</span>(state)) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::requestOpenDoors</span><span class="params">()</span> </span>&#123; currentState-&gt;<span class="built_in">openDoors</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::requestCloseDoors</span><span class="params">()</span> </span>&#123; currentState-&gt;<span class="built_in">closeDoors</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::requestMove</span><span class="params">()</span> </span>&#123; currentState-&gt;<span class="built_in">move</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::requestStop</span><span class="params">()</span> </span>&#123; currentState-&gt;<span class="built_in">stop</span>(<span class="keyword">this</span>); &#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::changeState</span><span class="params">(unique_ptr&lt;ElevatorState&gt; state)</span> </span>&#123;</span><br><span class="line">    currentState = <span class="built_in">move</span>(state);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ElevatorContext::displayState</span><span class="params">(<span class="type">const</span> string&amp; stateName)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Elevator is now in [&quot;</span> &lt;&lt; stateName &lt;&lt; <span class="string">&quot;] state\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态类方法实现</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsOpenState::openDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Doors are already open\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsOpenState::closeDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Closing doors...\n&quot;</span>;</span><br><span class="line">    context-&gt;<span class="built_in">changeState</span>(<span class="built_in">make_unique</span>&lt;DoorsClosedState&gt;());</span><br><span class="line">    context-&gt;<span class="built_in">displayState</span>(<span class="string">&quot;Doors Closed&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsOpenState::move</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cannot move while doors are open\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsOpenState::stop</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Already stopped with open doors\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsClosedState::openDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Opening doors...\n&quot;</span>;</span><br><span class="line">    context-&gt;<span class="built_in">changeState</span>(<span class="built_in">make_unique</span>&lt;DoorsOpenState&gt;());</span><br><span class="line">    context-&gt;<span class="built_in">displayState</span>(<span class="string">&quot;Doors Open&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsClosedState::closeDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Doors are already closed\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsClosedState::move</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Starting movement...\n&quot;</span>;</span><br><span class="line">    context-&gt;<span class="built_in">changeState</span>(<span class="built_in">make_unique</span>&lt;MovingState&gt;());</span><br><span class="line">    context-&gt;<span class="built_in">displayState</span>(<span class="string">&quot;Moving&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">DoorsClosedState::stop</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Already stopped with closed doors\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MovingState::openDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Cannot open doors while moving\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MovingState::closeDoors</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Doors are already closed\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MovingState::move</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Already moving\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">MovingState::stop</span><span class="params">(ElevatorContext* context)</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Stopping...\n&quot;</span>;</span><br><span class="line">    context-&gt;<span class="built_in">changeState</span>(<span class="built_in">make_unique</span>&lt;DoorsClosedState&gt;());</span><br><span class="line">    context-&gt;<span class="built_in">displayState</span>(<span class="string">&quot;Doors Closed&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="function">ElevatorContext <span class="title">elevator</span><span class="params">(make_unique&lt;DoorsOpenState&gt;())</span></span>;</span><br><span class="line">    </span><br><span class="line">    elevator.<span class="built_in">requestCloseDoors</span>(); <span class="comment">// 关门并进入门已关闭状态</span></span><br><span class="line">    elevator.<span class="built_in">requestMove</span>();       <span class="comment">// 开始移动</span></span><br><span class="line">    elevator.<span class="built_in">requestOpenDoors</span>();  <span class="comment">// 尝试开门（应失败）</span></span><br><span class="line">    elevator.<span class="built_in">requestStop</span>();       <span class="comment">// 停止并回到门已关闭状态</span></span><br><span class="line">    elevator.<span class="built_in">requestOpenDoors</span>();  <span class="comment">// 开门回到初始状态</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="观察者模式"><a href="#观察者模式" class="headerlink" title="观察者模式"></a>观察者模式</h3><p>​又称为发布-订阅模式，定义了一种一对多的依赖关系，让多个观察者对象同时检测某一主题对象，这个主题对象在状态变化时，会通知所有的观察者对象，使它们能够自动更新自己</p>
<p>结构：</p>
<ul>
<li><p>抽象主题（抽象被观察者），抽象主题角色吧所有观察者对象保存在一个集合里，每个主题都可以有任意数量的观察者，抽象主题提供一个接口，可以增加和删除观察者对象</p>
</li>
<li><p>具体主题（具体被观察者），该角色将有关状态存入具体观察者对象，在具体主题的内部状态发生改变时，给所有注册过的观察者发送通知。</p>
</li>
<li><p>抽象观察者，是观察者的抽象类，它定义了一个更新接口，使得在得到主题更改通知时更新自己。</p>
</li>
<li><p>具体观察者，实现抽象观察者定义的更新接口，以便在得到主题更改通知时更新自身的状态</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/20_%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B%E5%AD%90.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">update</span><span class="params">(Subject* subject)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Observer</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Subject</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;Observer*&gt; observers_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Subject</span>() = <span class="keyword">default</span>;  </span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">attach</span><span class="params">(Observer* observer)</span> </span>&#123;</span><br><span class="line">        observers_.<span class="built_in">push_back</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">detach</span><span class="params">(Observer* observer)</span></span>&#123;</span><br><span class="line">        observers_.<span class="built_in">erase</span>(<span class="built_in">remove</span>(observers_.<span class="built_in">begin</span>(),observers_.<span class="built_in">end</span>(),observer), observers_.<span class="built_in">end</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> observer: observers_)&#123;</span><br><span class="line">            observer-&gt;<span class="built_in">update</span>(<span class="keyword">this</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体主题：气象站</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WeatherStation</span> : <span class="keyword">public</span> Subject &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">float</span> temperature_;</span><br><span class="line">    <span class="type">float</span> humidity_;</span><br><span class="line">    <span class="type">float</span> pressure_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setMeasurements</span><span class="params">(<span class="type">float</span> temperature, <span class="type">float</span> humidity, <span class="type">float</span> pressure)</span> </span>&#123;</span><br><span class="line">        temperature_ = temperature;</span><br><span class="line">        humidity_ = humidity;</span><br><span class="line">        pressure_ = pressure;</span><br><span class="line">        <span class="built_in">notifyObservers</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">getTemperature</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> temperature_; &#125;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">getHumidity</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> humidity_; &#125;</span><br><span class="line">    <span class="function"><span class="type">float</span> <span class="title">getPressure</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> pressure_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者：当前天气状况显示 显示当前天气数据</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CurrentConditionsDisplay</span> : <span class="keyword">public</span> Observer &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    WeatherStation* weatherStation_;</span><br><span class="line">    <span class="type">float</span> temperature_;</span><br><span class="line">    <span class="type">float</span> humidity_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">CurrentConditionsDisplay</span>(WeatherStation* weatherStation)</span><br><span class="line">            : <span class="built_in">weatherStation_</span>(weatherStation) &#123;</span><br><span class="line">            weatherStation_-&gt;<span class="built_in">attach</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Subject* subject)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">auto</span> ws = <span class="built_in">dynamic_cast</span>&lt;WeatherStation*&gt;(subject)) &#123;</span><br><span class="line">            temperature_ = ws-&gt;<span class="built_in">getTemperature</span>();</span><br><span class="line">            humidity_ = ws-&gt;<span class="built_in">getHumidity</span>();</span><br><span class="line">            <span class="built_in">display</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Current conditions: &quot;</span></span><br><span class="line">                  &lt;&lt; temperature_ &lt;&lt; <span class="string">&quot;°C and &quot;</span></span><br><span class="line">                  &lt;&lt; humidity_ &lt;&lt; <span class="string">&quot;humidity\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者：天气预报显示 根据气压变化显示天气预报</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ForecastDisplay</span> : <span class="keyword">public</span> Observer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">ForecastDisplay</span><span class="params">(WeatherStation* weatherStation)</span></span></span><br><span class="line"><span class="function">        : weatherStation_(weatherStation) &#123;</span></span><br><span class="line">        weatherStation_-&gt;<span class="built_in">attach</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(Subject* subject)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">auto</span> ws = <span class="built_in">dynamic_cast</span>&lt;WeatherStation*&gt;(subject)) &#123;</span><br><span class="line">            lastPressure_ = currentPressure_;</span><br><span class="line">            currentPressure_ = ws-&gt;<span class="built_in">getPressure</span>();</span><br><span class="line">            <span class="built_in">display</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Forecast: &quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (currentPressure_ &gt; lastPressure_) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Improving weather!\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (currentPressure_ == lastPressure_) &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;More of the same\n&quot;</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            cout &lt;&lt; <span class="string">&quot;Watch out for cooler, rainy weather\n&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    WeatherStation* weatherStation_;</span><br><span class="line">    <span class="type">float</span> currentPressure_ = <span class="number">1013.0f</span>;</span><br><span class="line">    <span class="type">float</span> lastPressure_ = <span class="number">1013.0f</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    WeatherStation weatherStation;</span><br><span class="line">    </span><br><span class="line">    <span class="function">CurrentConditionsDisplay <span class="title">currentDisplay</span><span class="params">(&amp;weatherStation)</span></span>;</span><br><span class="line">    <span class="function">ForecastDisplay <span class="title">forecastDisplay</span><span class="params">(&amp;weatherStation)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟天气数据更新</span></span><br><span class="line">    weatherStation.<span class="built_in">setMeasurements</span>(<span class="number">25.0f</span>, <span class="number">65.0f</span>, <span class="number">1015.0f</span>);</span><br><span class="line">    weatherStation.<span class="built_in">setMeasurements</span>(<span class="number">22.5f</span>, <span class="number">70.0f</span>, <span class="number">1012.0f</span>);</span><br><span class="line">    weatherStation.<span class="built_in">setMeasurements</span>(<span class="number">20.0f</span>, <span class="number">90.0f</span>, <span class="number">1008.0f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//简单版本</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 观察者接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">float</span> temperature)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Observer</span>() = <span class="built_in">default</span>();</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 主题（被观察者）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TemperatureSensor</span> &#123;</span><br><span class="line">    std::vector&lt;Observer*&gt; observers_;</span><br><span class="line">    <span class="type">float</span> temperature_;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">attach</span><span class="params">(Observer* observer)</span> </span>&#123;</span><br><span class="line">        observers_.<span class="built_in">push_back</span>(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setTemperature</span><span class="params">(<span class="type">float</span> newTemp)</span> </span>&#123;</span><br><span class="line">        temperature_ = newTemp;</span><br><span class="line">        <span class="built_in">notifyObservers</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">notifyObservers</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> observer : observers_) &#123;</span><br><span class="line">            observer-&gt;<span class="built_in">update</span>(temperature_);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体观察者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Display</span> : <span class="keyword">public</span> Observer &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">update</span><span class="params">(<span class="type">float</span> temperature)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;温度更新: &quot;</span> &lt;&lt; temperature &lt;&lt; <span class="string">&quot;°C\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TemperatureSensor sensor;</span><br><span class="line">    Display display;</span><br><span class="line"></span><br><span class="line">    sensor.<span class="built_in">attach</span>(&amp;display);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟温度变化</span></span><br><span class="line">    sensor.<span class="built_in">setTemperature</span>(<span class="number">25.5</span>);</span><br><span class="line">    sensor.<span class="built_in">setTemperature</span>(<span class="number">23.0</span>);</span><br><span class="line">    sensor.<span class="built_in">setTemperature</span>(<span class="number">20.5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="中介者模式"><a href="#中介者模式" class="headerlink" title="中介者模式"></a>中介者模式</h3><p>又叫调停模式。定义一个中介角色来封装一系列对象之间的交互，使原有对象之间的耦合松散，且可以独立的改变他们之间的交互</p>
<p>结构：</p>
<ul>
<li><p>抽象中介者：中介者的借口，提供了同事对象注册与转发同事对象信息的抽象方法</p>
</li>
<li><p>具体中介：实现中介者借口，定义一个List集合来管理同事对象，协调各个同事角色之间的交互关系，因此它依赖于同事角色</p>
</li>
<li><p>抽象同事类：定义同事类的接口，保存中介者对象，提供同事对象交互的抽象方法，实现所有相互影响的同事类的公共功能</p>
</li>
<li><p>具体同事类：是抽象同事类的实现者，当需要与其他同事对象交互时，由中介者对象负责后续的交互</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前置声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Colleague</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象中介者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Mediator</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">sendMessage</span><span class="params">(<span class="type">const</span> string&amp; message,<span class="type">const</span> Colleague* sender)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">addColleague</span><span class="params">(Colleague* colleague)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Mediator</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象同事类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Colleague</span>&#123;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    Mediator* mediator_;</span><br><span class="line">    string name_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Colleague</span>(Mediator* mediator, <span class="type">const</span> string&amp; name)</span><br><span class="line">        : <span class="built_in">mediator_</span>(mediator), <span class="built_in">name_</span>(name) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> string&amp; message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> string&amp; message)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Colleague</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function">string <span class="title">getName</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> name_; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体中介者（聊天室）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ChatRoomMediator</span>:<span class="keyword">public</span> Mediator&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;Colleague*&gt; colleagues_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">addColleague</span><span class="params">(Colleague* colleague)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        colleagues_.<span class="built_in">push_back</span>(colleague);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">sendMessage</span><span class="params">(<span class="type">const</span> string&amp; message, <span class="type">const</span> Colleague* sender)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> colleague : colleagues_) &#123;</span><br><span class="line">            <span class="comment">// 不将消息发送给发送者自己</span></span><br><span class="line">            <span class="keyword">if</span> (colleague != sender) &#123;</span><br><span class="line">                colleague-&gt;<span class="built_in">receive</span>(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体同事类（用户）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span>: <span class="keyword">public</span> Colleague&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">User</span>(Mediator* mediator, <span class="type">const</span> string&amp; name)</span><br><span class="line">    : <span class="built_in">Colleague</span>(mediator, name) &#123;</span><br><span class="line">        mediator_-&gt;<span class="built_in">addColleague</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">send</span><span class="params">(<span class="type">const</span> string&amp; message)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; 发送消息: &quot;</span> &lt;&lt; message &lt;&lt; endl;</span><br><span class="line">        mediator_-&gt;<span class="built_in">sendMessage</span>(message, <span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">receive</span><span class="params">(<span class="type">const</span> string&amp; message)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">    cout &lt;&lt; name_ &lt;&lt; <span class="string">&quot; 收到消息: &quot;</span> &lt;&lt; message &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ChatRoomMediator chatRoom;</span><br><span class="line"></span><br><span class="line">    <span class="function">User <span class="title">alice</span><span class="params">(&amp;chatRoom, <span class="string">&quot;Alice&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">User <span class="title">bob</span><span class="params">(&amp;chatRoom, <span class="string">&quot;Bob&quot;</span>)</span></span>;</span><br><span class="line">    <span class="function">User <span class="title">charlie</span><span class="params">(&amp;chatRoom, <span class="string">&quot;Charlie&quot;</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    alice.<span class="built_in">send</span>(<span class="string">&quot;大家好！&quot;</span>);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    bob.<span class="built_in">send</span>(<span class="string">&quot;今天天气不错！&quot;</span>);</span><br><span class="line">    cout &lt;&lt; endl;</span><br><span class="line">    charlie.<span class="built_in">send</span>(<span class="string">&quot;有人想去喝咖啡吗？&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="迭代器模式"><a href="#迭代器模式" class="headerlink" title="迭代器模式"></a>迭代器模式</h3><p>提供一个对象来顺序访问聚合对象中的一系列数据，而不暴露聚合对象的内部表示</p>
<p>结构:</p>
<ul>
<li><p>抽象聚合对象：定义存储、添加、删除聚合元素以及创建迭代器对象的接口</p>
</li>
<li><p>具体聚合对象：实现抽象聚合类，返回一个具有迭代器的实例</p>
</li>
<li><p>抽象迭代器对象：定义访问和遍历聚合元素的接口，通常包含hasNext（）、next（）等方法</p>
</li>
<li><p>具体迭代器对象：实现抽象迭代器接口所定义的方法，完成对聚合对象的遍历，记录遍历当前位置</p>
</li>
</ul>
<p>将遍历的功能分开，专门使用一个类来管理</p>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/21_%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前向声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringCollection</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 迭代器接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Iterator</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">next</span><span class="params">()</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">bool</span> <span class="title">hasNext</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Iterator</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 集合接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Collection</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Collection</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> Iterator* <span class="title">createIterator</span><span class="params">()</span> <span class="type">const</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringIterator</span> : <span class="keyword">public</span> Iterator &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">const</span> StringCollection&amp; collection;</span><br><span class="line">    <span class="type">size_t</span> currentIndex;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">StringIterator</span>(<span class="type">const</span> StringCollection&amp; coll);</span><br><span class="line">    <span class="function">string <span class="title">next</span><span class="params">()</span> <span class="keyword">override</span></span>;</span><br><span class="line">    <span class="function"><span class="type">bool</span> <span class="title">hasNext</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span></span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体集合类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">StringCollection</span> : <span class="keyword">public</span> Collection &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string items[<span class="number">5</span>];</span><br><span class="line">    <span class="type">size_t</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(<span class="type">const</span> string&amp; item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (count &lt; <span class="number">5</span>) &#123;</span><br><span class="line">            items[count++] = item;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">size_t</span> <span class="title">size</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line">    <span class="function">string <span class="title">get</span><span class="params">(<span class="type">size_t</span> index)</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> items[index]; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">Iterator* <span class="title">createIterator</span><span class="params">()</span> <span class="type">const</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">StringIterator</span>(*<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体迭代器实现</span></span><br><span class="line">StringIterator::<span class="built_in">StringIterator</span>(<span class="type">const</span> StringCollection&amp; coll)</span><br><span class="line">    : <span class="built_in">collection</span>(coll), <span class="built_in">currentIndex</span>(<span class="number">0</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function">string <span class="title">StringIterator::next</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> collection.<span class="built_in">get</span>(currentIndex++);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">StringIterator::hasNext</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> currentIndex &lt; collection.<span class="built_in">size</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    StringCollection collection;</span><br><span class="line">    collection.<span class="built_in">add</span>(<span class="string">&quot;First&quot;</span>);</span><br><span class="line">    collection.<span class="built_in">add</span>(<span class="string">&quot;Second&quot;</span>);</span><br><span class="line">    collection.<span class="built_in">add</span>(<span class="string">&quot;Third&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Iterator* it = collection.<span class="built_in">createIterator</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (it-&gt;<span class="built_in">hasNext</span>()) &#123;</span><br><span class="line">        cout &lt;&lt; it-&gt;<span class="built_in">next</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">delete</span> it;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="访问者模式"><a href="#访问者模式" class="headerlink" title="访问者模式"></a>访问者模式</h3><p>​封装一些作用于某些数据结构中的各元素的操作，它可以在不改变这个数据结构的前提下定义作用于这些元素的新的操作</p>
<p>结构：</p>
<ul>
<li><p>抽象访问者：定义了对每一个元素访问的行为，它的参数就是可以访问的元素，它的方法个数理论上来讲与元素类个数是一样的，从这点不难看出，访问者模式要求元素的个数不能改变</p>
</li>
<li><p>具体访问者：给出对每一个元素类访问时所产生的具体行为<br>抽象元素：定义了一个接受访问者的方法，每一个元素都要可以被访问者访问</p>
</li>
<li><p>具体元素：提供接受访问方法的具体实现，而这个具体的实现，通常情况下是使用范文哲提供的访问该元素类的方法</p>
</li>
<li><p>对象结构角色：定义当中所提到的对象结构，对象结构是一个抽象表述，具体点可以理解为一个具有容器性质或者复合对象特征的类，它会含有一组元素，并且可以迭代这些元素，供访问者访问</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/22_%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 前置声明</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementA</span>;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementB</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象访问者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Visitor</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">visit</span><span class="params">(ConcreteElementA* element)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">visit</span><span class="params">(ConcreteElementB* element)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Visitor</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象元素</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Element</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> </span>= <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Element</span>() &#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素A</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementA</span> : <span class="keyword">public</span> Element &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        visitor-&gt;<span class="built_in">visit</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">operationA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;具体元素A的操作&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素B</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteElementB</span> : <span class="keyword">public</span> Element &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        visitor-&gt;<span class="built_in">visit</span>(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">operationB</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;具体元素B的操作&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体访问者</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ConcreteVisitor</span> : <span class="keyword">public</span> Visitor &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ConcreteElementA* element)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;访问者正在访问 &quot;</span> &lt;&lt; element-&gt;<span class="built_in">operationA</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">visit</span><span class="params">(ConcreteElementB* element)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;访问者正在访问 &quot;</span> &lt;&lt; element-&gt;<span class="built_in">operationB</span>() &lt;&lt; endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 对象结构（管理元素集合）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ObjectStructure</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;Element*&gt; elements;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">add</span><span class="params">(Element* element)</span> </span>&#123;</span><br><span class="line">        elements.<span class="built_in">push_back</span>(element);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">accept</span><span class="params">(Visitor* visitor)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> elem : elements) &#123;</span><br><span class="line">            elem-&gt;<span class="built_in">accept</span>(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    ObjectStructure structure;</span><br><span class="line">    structure.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="built_in">ConcreteElementA</span>());</span><br><span class="line">    structure.<span class="built_in">add</span>(<span class="keyword">new</span> <span class="built_in">ConcreteElementB</span>());</span><br><span class="line">    </span><br><span class="line">    ConcreteVisitor visitor;</span><br><span class="line">    structure.<span class="built_in">accept</span>(&amp;visitor);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="备忘录模式"><a href="#备忘录模式" class="headerlink" title="备忘录模式"></a>备忘录模式</h3><p>又叫快照模式，在不破坏封装性的前提下，捕获一个对象的内部状态，并在该对象之外保存这个状态，以便以后当需要时能将该对象恢复到原先保存的状态</p>
<p>结构：</p>
<ul>
<li><p>发起人角色：记录当前时刻的内部状态信息，提供创建备忘录和回复备忘录数据的功能，实现其他业务功能，它可以访问备忘录里的所有信息。</p>
</li>
<li><p>备忘录角色：负责存储发起人的内部状态，在需要的时候提供这些内部状态给发起人</p>
</li>
<li><p>管理者角色：对备忘录进行管理，提供保存与获取备忘录的功能，但其不能对备忘录的内容进行访问和修改</p>
</li>
</ul>
<p><img src="/img/load4.gif" data-original="/../0_images/DesignPattern/23_%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%E5%BC%95%E4%BE%8B.png" alt="alt text"></p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 白盒实现：Memento 内部状态对 Caretaker 可见</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextMemento</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string text_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">TextMemento</span>(string text) : <span class="built_in">text_</span>(<span class="built_in">move</span>(text)) &#123;&#125;</span><br><span class="line">    <span class="comment">// 暴露内部状态的公共方法</span></span><br><span class="line">    <span class="function">string <span class="title">GetText</span><span class="params">()</span> <span class="type">const</span> </span>&#123; <span class="keyword">return</span> text_; &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">SetText</span><span class="params">(<span class="type">const</span> string&amp; text)</span> </span>&#123; text_ = text; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Originator（原发器）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string content_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Write</span><span class="params">(<span class="type">const</span> string&amp; text)</span> </span>&#123; content_ += text; &#125;</span><br><span class="line">    <span class="function">TextMemento <span class="title">CreateMemento</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">TextMemento</span>(content_);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">RestoreMemento</span><span class="params">(<span class="type">const</span> TextMemento&amp; memento)</span> </span>&#123;</span><br><span class="line">        content_ = memento.<span class="built_in">GetText</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        cout &lt;&lt; <span class="string">&quot;Current content: &quot;</span> &lt;&lt; content_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker（管理者）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    vector&lt;TextMemento&gt; history_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Save</span><span class="params">(<span class="type">const</span> TextMemento&amp; memento)</span> </span>&#123;</span><br><span class="line">        history_.<span class="built_in">push_back</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">TextMemento <span class="title">Undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!history_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> history_.<span class="built_in">back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">TextMemento</span>(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    TextEditor editor;</span><br><span class="line">    History history;</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">Write</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    history.<span class="built_in">Save</span>(editor.<span class="built_in">CreateMemento</span>());</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">Write</span>(<span class="string">&quot; World&quot;</span>);</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">RestoreMemento</span>(history.<span class="built_in">Undo</span>());</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象备忘录接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IMemento</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">IMemento</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Originator（原发器）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string content_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">// 内部 Memento 实现</span></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">TextMemento</span> : <span class="keyword">public</span> IMemento &#123;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">        <span class="built_in">TextMemento</span>(std::string text) : <span class="built_in">text_</span>(std::<span class="built_in">move</span>(text)) &#123;&#125;</span><br><span class="line">        <span class="comment">// 只有 TextEditor 可以访问私有成员</span></span><br><span class="line">        <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">TextEditor</span>;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        std::string text_;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Write</span><span class="params">(<span class="type">const</span> std::string&amp; text)</span> </span>&#123; content_ += text; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">IMemento* <span class="title">CreateMemento</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">TextMemento</span>(content_);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">RestoreMemento</span><span class="params">(<span class="type">const</span> IMemento* memento)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> concrete = <span class="built_in">dynamic_cast</span>&lt;<span class="type">const</span> TextMemento*&gt;(memento);</span><br><span class="line">        <span class="keyword">if</span> (concrete) &#123;</span><br><span class="line">            content_ = concrete-&gt;text_;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Show</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;Current content: &quot;</span> &lt;&lt; content_ &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// Caretaker（管理者）</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::vector&lt;IMemento*&gt; history_;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Save</span><span class="params">(IMemento* memento)</span> </span>&#123;</span><br><span class="line">        history_.<span class="built_in">emplace_back</span>(memento);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function">IMemento* <span class="title">Undo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!history_.<span class="built_in">empty</span>()) &#123;</span><br><span class="line">            <span class="keyword">return</span> history_.<span class="built_in">back</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nullptr</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用示例</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    TextEditor editor;</span><br><span class="line">    History history;</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">Write</span>(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">    history.<span class="built_in">Save</span>(editor.<span class="built_in">CreateMemento</span>());</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">Write</span>(<span class="string">&quot; World&quot;</span>);</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line">    </span><br><span class="line">    editor.<span class="built_in">RestoreMemento</span>(history.<span class="built_in">Undo</span>());</span><br><span class="line">    editor.<span class="built_in">Show</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>白盒实现：</p>
<ul>
<li><p>Memento 类保持公共接口</p>
</li>
<li><p>Caretaker 可以直接访问 Memento 的内部状态</p>
</li>
<li><p>实现简单但破坏了封装性</p>
</li>
</ul>
<p>黑盒实现：</p>
<ul>
<li><p>使用接口类 IMemento 隐藏实现细节</p>
</li>
<li><p>具体 Memento 作为 Originator 的内部类</p>
</li>
<li><p>通过友元关系保持封装性</p>
</li>
<li><p>Caretaker 只能处理抽象接口</p>
</li>
<li><p>更符合面向对象设计原则</p>
</li>
</ul>
<h3 id="解释器模式"><a href="#解释器模式" class="headerlink" title="解释器模式"></a>解释器模式</h3><p>​给定一个语言，定义它的文法表示，并定义一个解释器，这个解释器使用该标识来解释语言中的句子。</p>
<p>结构：</p>
<ul>
<li><p>抽象表达式角色： 定义解释器的接口，约定解释器的解释操作，主要包含解释方法interpret</p>
</li>
<li><p>终结符表达式角色：是抽象表达式的子类，用来实现文法中与终结符相关的操作，文法中的每一个终结符都有一个具体终结表达式与之对应</p>
</li>
<li><p>非终结符表达式角色：也是抽象表达式的子类。是来实现文法中与非终结符相关的操作，文法中发每条规则都对应于一个非终结符表达式</p>
</li>
<li><p>环境角色：通常包含各个解释器需要的数据或者是公共的功能，一般用来传递被所有解释器共享的数据，后面的解释器可以从这里获取这些值</p>
</li>
<li><p>客户端：主要任务是将需要分析的句子或表达式转换成使用解释器对象描述的抽象语法树，然后调用解释器的解释方法，当然也可以通过环境角色间接访问解释器的解释方法</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unordered_map&lt;string, <span class="type">int</span>&gt; variables;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">setVariable</span><span class="params">(<span class="type">const</span> string&amp; var, <span class="type">int</span> value)</span> </span>&#123;</span><br><span class="line">        variables[var] = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">getVariable</span><span class="params">(<span class="type">const</span> string&amp; var)</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> variables.<span class="built_in">at</span>(var); <span class="comment">// 使用at()进行安全访问</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象表达式接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">Expression</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> <span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> Context&amp; context)</span> </span>= <span class="number">0</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 终结符表达式：变量</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">VariableExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    string varName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">VariableExpression</span><span class="params">(string var)</span> : varName(move(var)) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> Context&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> context.<span class="built_in">getVariable</span>(varName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 终结符表达式：数字常量</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NumberExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="type">int</span> number;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">explicit</span> <span class="title">NumberExpression</span><span class="params">(<span class="type">int</span> num)</span> : number(num) &#123;</span>&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> Context&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非终结符表达式：加法操作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unique_ptr&lt;Expression&gt; left;</span><br><span class="line">    unique_ptr&lt;Expression&gt; right;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">AddExpression</span>(unique_ptr&lt;Expression&gt; l, unique_ptr&lt;Expression&gt; r)</span><br><span class="line">        : <span class="built_in">left</span>(<span class="built_in">move</span>(l)), <span class="built_in">right</span>(<span class="built_in">move</span>(r)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> Context&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>(context) + right-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非终结符表达式：减法操作</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubtractExpression</span> : <span class="keyword">public</span> Expression &#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    unique_ptr&lt;Expression&gt; left;</span><br><span class="line">    unique_ptr&lt;Expression&gt; right;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">SubtractExpression</span>(unique_ptr&lt;Expression&gt; l, unique_ptr&lt;Expression&gt; r)</span><br><span class="line">        : <span class="built_in">left</span>(<span class="built_in">move</span>(l)), <span class="built_in">right</span>(<span class="built_in">move</span>(r)) &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">interpret</span><span class="params">(<span class="type">const</span> Context&amp; context)</span> <span class="keyword">override</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> left-&gt;<span class="built_in">interpret</span>(context) - right-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Context context;</span><br><span class="line">    context.<span class="built_in">setVariable</span>(<span class="string">&quot;x&quot;</span>, <span class="number">10</span>);</span><br><span class="line">    context.<span class="built_in">setVariable</span>(<span class="string">&quot;y&quot;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 构建表达式树：(x + 20) - (y + 5)</span></span><br><span class="line">    <span class="keyword">auto</span> expr = <span class="built_in">make_unique</span>&lt;SubtractExpression&gt;(</span><br><span class="line">        <span class="built_in">make_unique</span>&lt;AddExpression&gt;(</span><br><span class="line">            <span class="built_in">make_unique</span>&lt;VariableExpression&gt;(<span class="string">&quot;x&quot;</span>),</span><br><span class="line">            <span class="built_in">make_unique</span>&lt;NumberExpression&gt;(<span class="number">20</span>)</span><br><span class="line">        ),</span><br><span class="line">        <span class="built_in">make_unique</span>&lt;AddExpression&gt;(</span><br><span class="line">            <span class="built_in">make_unique</span>&lt;VariableExpression&gt;(<span class="string">&quot;y&quot;</span>),</span><br><span class="line">            <span class="built_in">make_unique</span>&lt;NumberExpression&gt;(<span class="number">5</span>)</span><br><span class="line">        )</span><br><span class="line">    );</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> result = expr-&gt;<span class="built_in">interpret</span>(context);</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;计算结果: &quot;</span> &lt;&lt; result &lt;&lt; endl; <span class="comment">// 输出：20 = (10+20)-(5+5)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">张振强</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2025/04/13/DesignPattern/">http://example.com/2025/04/13/DesignPattern/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">张振强的个人博客</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a><a class="post-meta__tags" href="/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/">设计模式</a></div><div class="post-share"><div class="social-share" data-image="/img/cover/3.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/04/13/C++Thread/" title="C++ Thread"><img class="cover" src="/img/load4.gif" data-original="/img/cover/1.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">C++ Thread</div></div><div class="info-2"><div class="info-item-1">C++线程基本介绍：1.多线程的含义 多线程（multithreading），是指在软件或者硬件上实现多个线程并发执行的技术。具有多核CPU的支持的计算机能够真正在同一时间执行多个程序片段，进而提升程序的处理性能。在一个程序中，这些独立运行的程序片段被称为“线程”（Thread），利用其编程的概念就叫作“多线程处理”。 2.进程与线程的区别 进程是指一个程序的运行实例，而线程是指进程中独立的执行流程。一个进程可以有多个线程，多个线程之间可以并发执行。  一个程序有且只有一个进程，但可以拥有至少一个的线程。  不同进程拥有不同的地址空间，互不相关，而不同线程共同拥有相同进程的地址空间。   线程创建thread #include&lt;iostream&gt;#include&lt;thread&gt;using namespace std;void ThreadFunctionA(int A)&#123;    for(int i=0;i&lt;A;i++)&#123;        cout&lt;&lt;&quot;线程...</div></div></div></a><a class="pagination-related" href="/2025/04/13/kinglyWay-dataStructure/" title="数据结构 王道2026学习笔记(还没学习完)"><img class="cover" src="/img/load4.gif" data-original="/img/cover/5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">数据结构 王道2026学习笔记(还没学习完)</div></div><div class="info-2"><div class="info-item-1">数据结构 王道2026学习笔记第一章 绪论1.1 数据结构的基本概念概念和术语 数据数据是描述客观事物的符号，是计算机中可以操作的对象，是能被计算机识别，并输入给计算机处理的符号集合。  数据元素数据元素是数据的基本单位，在计算机中通常作为一个整体进行考虑和处理。  数据项一个数据元素可以由若干个数据项组成，数据项是数据不可分割的最小单位。  数据对象数据对象是性质相同的数据元素的集合，是数据的子集。  数据类型 数据类型是一个值的集合和定义在此集合上的一组操作的总称。  原子类型：其值不可再分的类型，如整型、浮点型、字符型等。 结构类型：其值可以再分的类型，如整形数组、浮点型数组、结构体、链表、栈、队列等。 抽象数据类型（Abstract Data Type,...</div></div></div></a></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/13/C++Thread/" title="C++ Thread"><img class="cover" src="/img/load4.gif" data-original="/img/cover/1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ Thread</div></div><div class="info-2"><div class="info-item-1">C++线程基本介绍：1.多线程的含义 多线程（multithreading），是指在软件或者硬件上实现多个线程并发执行的技术。具有多核CPU的支持的计算机能够真正在同一时间执行多个程序片段，进而提升程序的处理性能。在一个程序中，这些独立运行的程序片段被称为“线程”（Thread），利用其编程的概念就叫作“多线程处理”。 2.进程与线程的区别 进程是指一个程序的运行实例，而线程是指进程中独立的执行流程。一个进程可以有多个线程，多个线程之间可以并发执行。  一个程序有且只有一个进程，但可以拥有至少一个的线程。  不同进程拥有不同的地址空间，互不相关，而不同线程共同拥有相同进程的地址空间。   线程创建thread #include&lt;iostream&gt;#include&lt;thread&gt;using namespace std;void ThreadFunctionA(int A)&#123;    for(int i=0;i&lt;A;i++)&#123;        cout&lt;&lt;&quot;线程...</div></div></div></a><a class="pagination-related" href="/2025/04/13/C++STL/" title="C++ STL"><img class="cover" src="/img/load4.gif" data-original="/img/cover/7.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ STL</div></div><div class="info-2"><div class="info-item-1">简单的学习以下C++的STL基本概念：STL主要分为分为三类：  algorithm（算法）  -   对数据进行处理(解决问题)步骤的有限集合  container（容器）  -   用来管理一组数据元素  Iterator  (迭代器) -   可遍历STL容器内全部或部分元素的对象   容器 &lt;vector&gt;,&lt;list&gt;,&lt;deque&gt;,&lt;set&gt;,&lt;map&gt;,&lt;stack&gt;...</div></div></div></a><a class="pagination-related" href="/2025/04/13/C++base/" title="C++ base"><img class="cover" src="/img/load4.gif" data-original="/img/cover/8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ base</div></div><div class="info-2"><div class="info-item-1">C++基础资料：https://blog.csdn.net/weixin_44368437/article/details/117563488 C++与 C...</div></div></div></a><a class="pagination-related" href="/2025/04/13/C++friend/" title="C++ friend"><img class="cover" src="/img/load4.gif" data-original="/img/cover/10.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ friend</div></div><div class="info-2"><div class="info-item-1">C++友元使用前提：某个类需要实现某种功能，但是这个类自身，因为各种原因，无法自己实现。 需要借助于“外力”才能实现。 友元的两种使用形式：友元函数、友元类。 友元函数使用全局函数作为友元函数全局函数可以直接访问类内的私有成员！！！！！ #include&lt;iostream&gt;#include &lt;sstream&gt;using namespace std;class Computer &#123; public:    Computer()&#123;        cpu = &quot;i7&quot;;    &#125;;    // 使用全局函数作为友元函数    friend void upgrade(Computer* computer);    string description()&#123;        stringstream ret;         ret &lt;&lt; &quot;CPU:&quot; &lt;&lt; cpu;         return ret.str();    &#125;;private:    ...</div></div></div></a><a class="pagination-related" href="/2025/04/13/C++exception/" title="C++ exception"><img class="cover" src="/img/load4.gif" data-original="/img/cover/1.png" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ exception</div></div><div class="info-2"><div class="info-item-1">C++异常处理异常无处不在，程序随时可能误入歧途！C++ 提出了新的异常处理机制！ 异常是一种程序控制机制，与函数机制互补 函数是一种以栈结构展开的上下函数衔接的程序控制系统,异常是另一种控制结构,它可以在出现“意外”时中断当前函数,并以某种机制（类型匹配）回馈给隔代的调用者相关的信息. 传统错误处理机制通过函数返回值来处理错误 #include &lt;stdio.h&gt;#include &lt;stdlib.h&gt; #define BUFSIZE 1024 //实现文件的二进制拷贝int copyfile(const char *dest,const char *src)&#123;	FILE *fp1 = NULL, *fp2 = NULL; 	//rb 只读方式打开一个二进制文件，只允许读取数据	fopen_s(&amp;fp1, src, &quot;rb&quot;); 	if(fp1 == NULL)&#123;		return -1;	&#125; 	//wb 以只写的方式打开或新建一个二进制文件，只允许写数据。	fopen_s(&amp;fp2,...</div></div></div></a><a class="pagination-related" href="/2025/04/13/C++operaOvlod/" title="C++ operaOvlod"><img class="cover" src="/img/load4.gif" data-original="/img/cover/8.jpg" alt="cover"><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-13</div><div class="info-item-2">C++ operaOvlod</div></div><div class="info-2"><div class="info-item-1">C++运算法重载C&#x2F;C++的运算符，支持的数据类型，仅限于基本数据类型。 问题：  一头牛+一头马 &#x3D; ？（牛马神兽？）  一个圆 +一个圆 &#x3D; ？ （想要变成一个更大的圆）  一头牛 – 一只羊 &#x3D; ？ (想要变成 4 只羊，原始的以物易物：1 头牛价值 5 只羊)   解决方案：使用运算符重载 那些可以重载  为了防止对标准类型进行运算符重载，   C++规定重载运算符的操作对象至少有一个不是标准类型，而是用户自定义的类型比如不能重载 1+2 但是可以重载            cow + 2 和 2 + cow    // cow 是自定义的对象   不能改变原运算符的语法规则， 比如不能把双目运算符重载为单目运算  不能改变原运算符的优先级  不能创建新的运算符，比如 operator*就是非法的, operator是可以的  不能对以下这四种运算符，使用友元函数进行重载&#x3D; 赋值运算符，（）函数调用运算符，[...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/load4.gif" data-original="/img/paidaxing_icon.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">张振强</div><div class="author-info-description">咱们都是最棒的</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">23</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">8</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">4</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/zqzhang2023"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/zqzhang2023" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="https://blog.csdn.net/weixin_45769058" target="_blank" title="CSDN"><i class="fa fa-book-open"></i></a><a class="social-icon" href="tencent://AddContact/?fromId=45&amp;fromSubId=1&amp;subcmd=all&amp;uin=1611379529&amp;website=www.oicqzone.com" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="mailto:bzzhenqiang@163.com" target="_blank" title="Email"><i class="fas fa-envelope-open-text"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">This is my Blog</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#C-%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.</span> <span class="toc-text">C++设计模式</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BD%AF%E4%BB%B6%E7%9A%84%E8%AE%BE%E8%AE%A1%E5%8E%9F%E5%88%99"><span class="toc-number">1.1.</span> <span class="toc-text">软件的设计原则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99%EF%BC%88OCP%EF%BC%89"><span class="toc-number">1.1.1.</span> <span class="toc-text">开闭原则（OCP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%87%8C%E6%B0%8F%E6%9B%BF%E6%8D%A2%E5%8E%9F%E5%88%99%EF%BC%88LSP%EF%BC%89"><span class="toc-number">1.1.2.</span> <span class="toc-text">里氏替换原则（LSP）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%9D%E8%B5%96%E5%80%92%E7%BD%AE%E5%8E%9F%E5%88%99-DIP"><span class="toc-number">1.1.3.</span> <span class="toc-text">依赖倒置原则(DIP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E9%9A%94%E7%A6%BB%E5%8E%9F%E5%88%99-ISP"><span class="toc-number">1.1.4.</span> <span class="toc-text">接口隔离原则(ISP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%B8%80%E8%81%8C%E8%B4%A3%E5%8E%9F%E5%88%99-SRP"><span class="toc-number">1.1.5.</span> <span class="toc-text">单一职责原则(SRP)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E5%86%85%E8%81%9A%E3%80%81%E4%BD%8E%E8%80%A6%E5%90%88"><span class="toc-number">1.2.</span> <span class="toc-text">高内聚、低耦合</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.</span> <span class="toc-text">创建型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.1.</span> <span class="toc-text">简单工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.2.</span> <span class="toc-text">工厂模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E7%A8%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.3.</span> <span class="toc-text">抽象工程模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.4.</span> <span class="toc-text">单例模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%94%9F%E6%88%90%E5%99%A8-buider-%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.3.5.</span> <span class="toc-text">生成器(buider)模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.</span> <span class="toc-text">结构型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.1.</span> <span class="toc-text">代理模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.2.</span> <span class="toc-text">适配器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.3.</span> <span class="toc-text">装饰者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.4.</span> <span class="toc-text">桥接模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.5.</span> <span class="toc-text">外观模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.6.</span> <span class="toc-text">组合模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.4.7.</span> <span class="toc-text">享元模式</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.</span> <span class="toc-text">行为型模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.1.</span> <span class="toc-text">模板方法模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.2.</span> <span class="toc-text">策略模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.3.</span> <span class="toc-text">命令模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.4.</span> <span class="toc-text">责任链模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.5.</span> <span class="toc-text">状态模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.6.</span> <span class="toc-text">观察者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.7.</span> <span class="toc-text">中介者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.8.</span> <span class="toc-text">迭代器模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.9.</span> <span class="toc-text">访问者模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.10.</span> <span class="toc-text">备忘录模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F"><span class="toc-number">1.5.11.</span> <span class="toc-text">解释器模式</span></a></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/04/17/ffmpeg/" title="ffmpeg"><img src="/img/load4.gif" data-original="/img/cover/11.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="ffmpeg"/></a><div class="content"><a class="title" href="/2025/04/17/ffmpeg/" title="ffmpeg">ffmpeg</a><time datetime="2025-04-17T14:51:36.000Z" title="发表于 2025-04-17 22:51:36">2025-04-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/tinyWebServer/" title="tinyWebServer"><img src="/img/load4.gif" data-original="/img/cover/5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="tinyWebServer"/></a><div class="content"><a class="title" href="/2025/04/15/tinyWebServer/" title="tinyWebServer">tinyWebServer</a><time datetime="2025-04-15T14:58:54.000Z" title="发表于 2025-04-15 22:58:54">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/15/chatRoom/" title="chatRoom"><img src="/img/load4.gif" data-original="/img/cover/9.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="chatRoom"/></a><div class="content"><a class="title" href="/2025/04/15/chatRoom/" title="chatRoom">chatRoom</a><time datetime="2025-04-15T14:57:54.000Z" title="发表于 2025-04-15 22:57:54">2025-04-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/kinglyWay-dataStructure/" title="数据结构 王道2026学习笔记(还没学习完)"><img src="/img/load4.gif" data-original="/img/cover/5.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据结构 王道2026学习笔记(还没学习完)"/></a><div class="content"><a class="title" href="/2025/04/13/kinglyWay-dataStructure/" title="数据结构 王道2026学习笔记(还没学习完)">数据结构 王道2026学习笔记(还没学习完)</a><time datetime="2025-04-12T16:09:40.000Z" title="发表于 2025-04-13 00:09:40">2025-04-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/04/13/kinglyWay-operatingSystem/" title="计算机操作系统 王道2026学习笔记"><img src="/img/load4.gif" data-original="/img/cover/10.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="计算机操作系统 王道2026学习笔记"/></a><div class="content"><a class="title" href="/2025/04/13/kinglyWay-operatingSystem/" title="计算机操作系统 王道2026学习笔记">计算机操作系统 王道2026学习笔记</a><time datetime="2025-04-12T16:09:40.000Z" title="发表于 2025-04-13 00:09:40">2025-04-13</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url(/img/index_img.jpg);"><div id="footer-wrap"><div class="copyright">&copy;2019 - 2025 By 张振强</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.3.5</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script id="canvas_nest" defer="defer" color="0,0,255" opacity="0.7" zIndex="-1" count="99" mobile="false" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-nest.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="text-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>